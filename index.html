<!DOCTYPE html>
<head>
    <style>
        /* ... Style ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ... */
        .log-entry { 
            display: flex; 
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px; 
            border-bottom: 1px dotted #ccc; 
            padding-bottom: 8px; 
            font-size: 0.95em; 
        }
        .log-date-header {
            /* ... Style ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ... */
        }
        .delete-btn {
            /* ... Style ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ... */
        }
        .log-note { /* Style ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡∏¥‡∏° */
            font-size: 0.85em;
            color: #777;
            margin-top: 3px;
        }
    </style>
</head>
<body>

    <div class="stock-display" id="current-stock">
        <h2>‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö)</h2>
    </div>

    <div class="transaction-form" id="adjustment-area">
        <h2>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ï‡πä‡∏≠‡∏Å (Admin)</h2>
        <div class="form-control">
            <label for="adj-ice-type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</label>
            <select id="adj-ice-type">
                <option value="‡∏´‡∏•‡∏≠‡∏î">‡∏´‡∏•‡∏≠‡∏î</option><option value="‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö">‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö</option><option value="‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</option>
            </select>
        </div>
        <div class="form-control">
            <label for="adj-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î (+/-):</label>
            <input type="number" id="adj-quantity" value="1" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50 ‡∏´‡∏£‡∏∑‡∏≠ -10">
        </div>
        <button onclick="adjustStock()" style="background: #ffc107; color: black; margin-top: 5px;">‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ï‡πä‡∏≠‡∏Å</button>
    </div>
    
    <div class="transaction-form">
        <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏Ç‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô)</h2>
        <div class="form-control">
            <label for="factory-ice-type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á:</label>
            <select id="factory-ice-type">
                <option value="‡∏´‡∏•‡∏≠‡∏î">‡∏´‡∏•‡∏≠‡∏î</option><option value="‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö">‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö</option><option value="‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</option>
            </select>
        </div>
        <div class="form-control">
            <label for="factory-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö:</label>
            <input type="number" id="factory-quantity" min="1" value="1">
        </div>
        <button onclick="recordFactorySale()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô</button>
    </div>
    
    <div class="transaction-form">
        <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏£‡∏ñ‡∏≠‡∏≠‡∏Å/‡πÄ‡∏Ç‡πâ‡∏≤)</h2>
        <div class="form-control">
            <label for="truck-id">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏£‡∏ñ:</label>
            <select id="truck-id">
                <option value="1">‡∏£‡∏ñ 1</option><option value="2">‡∏£‡∏ñ 2</option><option value="3">‡∏£‡∏ñ 3</option>
                <option value="4">‡∏£‡∏ñ 4</option><option value="5">‡∏£‡∏ñ 5</option><option value="6">‡∏£‡∏ñ 6</option>
                <option value="7">‡∏£‡∏ñ 7</option><option value="8">‡∏£‡∏ñ 8</option><option value="9">‡∏£‡∏ñ 9</option>
            </select>
        </div>
        <div class="form-control">
            <label for="ice-type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á:</label>
            <select id="ice-type">
                <option value="‡∏´‡∏•‡∏≠‡∏î">‡∏´‡∏•‡∏≠‡∏î</option><option value="‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö">‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö</option><option value="‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</option>
            </select>
        </div>
        <div class="form-control">
            <label for="quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö (‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö):</label>
            <input type="number" id="quantity" min="1" value="1">
        </div>
        <div class="form-control">
            <label for="action-type">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥:</label>
            <select id="action-type" onchange="toggleSpoiledField()">
                <option value="OUT">‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å (‡πÑ‡∏õ‡∏™‡πà‡∏á)</option><option value="IN">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏ï‡πä‡∏≠‡∏Å)</option>
            </select>
        </div>

        <div class="form-control" id="spoiled-field" style="display: none;">
            <label for="spoiled-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà **‡πÄ‡∏™‡∏µ‡∏¢/‡∏ñ‡∏π‡∏Å‡∏ï‡∏µ‡∏Å‡∏•‡∏±‡∏ö**:</label>
            <input type="number" id="spoiled-quantity" min="0" value="0">
        </div>

        <button onclick="recordTransaction()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    </div>

    <div class="log-area">
        <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
        <div class="log-list" id="transaction-log">
        </div>
        <button onclick="exportLogToCSV()" style="background: #007bff; font-size: 16px; margin-top: 5px;">
            Export Log (‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV)
        </button>
        <button onclick="clearLogHistory()" style="background: #dc3545; font-size: 16px; margin-top: 5px;">
            ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô)
        </button>
    </div>

    <script>
        // ... ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (getLog, addLog, deleteLogEntry ‡∏Ø‡∏•‡∏Ø) ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ...
        // ... ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô recordFactorySale, adjustStock, clearLogHistory, exportLogToCSV ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ...

        const INITIAL_STOCK = { "‡∏´‡∏•‡∏≠‡∏î": 100, "‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö": 50, "‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î": 30 };
        const STOCK_KEY = 'ajarnG_ice_stock';
        const LOG_KEY = 'ajarnG_ice_log';

        // ----------------------------------------------------
        // 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Handlers) - (‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        // ----------------------------------------------------
        function getStock() {
            const stockData = localStorage.getItem(STOCK_KEY);
            return stockData ? JSON.parse(stockData) : INITIAL_STOCK;
        }

        function saveStock(stock) {
            localStorage.setItem(STOCK_KEY, JSON.stringify(stock));
        }

        function getLog() {
            const logData = localStorage.getItem(LOG_KEY);
            let log = logData ? JSON.parse(logData) : [];
            return log.sort((a, b) => b.timestamp - a.timestamp); 
        }

        function addLog(newEntry) {
            const log = getLog();
            newEntry.id = Date.now() + Math.random().toString(16).slice(2); 
            log.push(newEntry);
            localStorage.setItem(LOG_KEY, JSON.stringify(log)); 
        }
        
        function deleteLogEntry(logId) {
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ? ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ô‡∏∞!')) {
                return;
            }
            let log = getLog();
            const deletedEntry = log.find(entry => entry.id === logId);

            if (!deletedEntry) {
                alert('‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠!');
                return;
            }

            let currentStock = getStock();
            const type = deletedEntry.ice_type;
            const quantity = deletedEntry.quantity;
            const action = deletedEntry.action;

            if (action === 'OUT' || action === 'FSALE') {
                currentStock[type] += quantity;
            } else if (action === 'IN') {
                currentStock[type] -= quantity;
            } else if (action === 'ADJ') {
                currentStock[type] -= quantity;
            } 
            
            if (currentStock[type] < 0) {
                 alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ! ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢ Admin ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö)!');
                 return;
            }
            
            saveStock(currentStock);

            log = log.filter(entry => entry.id !== logId);
            localStorage.setItem(LOG_KEY, JSON.stringify(log)); 

            renderStock();
            renderLog();
            alert('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!');
        }

        // ----------------------------------------------------
        // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Render Functions) - **‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**
        // ----------------------------------------------------

        function renderStock() {
            const stock = getStock();
            const stockContainer = document.getElementById('current-stock');
            stockContainer.innerHTML = '<h2>‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö)</h2>'; 
            for (const type in stock) {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'stock-item';
                itemDiv.innerHTML = `<strong>${type}:</strong><span>${stock[type]} ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</span>`;
                stockContainer.appendChild(itemDiv);
            }
        }

        function renderLog() {
            const allLog = getLog();
            const logContainer = document.getElementById('transaction-log');
            logContainer.innerHTML = ''; 

            let lastDate = ''; 
            const renderedLogIds = new Set(); // ‡πÄ‡∏Å‡πá‡∏ö ID ‡∏Ç‡∏≠‡∏á Log ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å Render ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡πÉ‡∏ä‡πâ‡∏ã‡πà‡∏≠‡∏ô Log ‡πÄ‡∏™‡∏µ‡∏¢)

            allLog.forEach((entry, index) => {
                if (renderedLogIds.has(entry.id)) {
                    return; // ‡∏Ç‡πâ‡∏≤‡∏° Log ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏ß‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
                }
                
                const date = new Date(entry.timestamp);
                const dateStr = date.toLocaleDateString('th-TH');

                // 1. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô
                if (dateStr !== lastDate) {
                    const dateHeader = document.createElement('div');
                    dateHeader.className = 'log-date-header';
                    dateHeader.innerHTML = `--- üìÖ ${dateStr} ---`;
                    logContainer.appendChild(dateHeader);
                    lastDate = dateStr;
                }
                
                // 2. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î Log
                const timeStr = date.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                
                let actionText;
                let truckInfo;
                let extraNote = '';

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏° Log "‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏Ç‡∏≠‡∏á‡∏î‡∏µ)" ‡∏Å‡∏±‡∏ö "‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡πÄ‡∏™‡∏µ‡∏¢"
                if (entry.action === 'IN') {
                    // ‡∏•‡∏≠‡∏á‡∏´‡∏≤ Log ‡πÄ‡∏™‡∏µ‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡πÜ ‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (‡∏´‡∏£‡∏∑‡∏≠ +1ms ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ)
                    const spoiledEntry = allLog.slice(index + 1).find(
                        nextEntry => 
                        nextEntry.action === 'SPOIL' && 
                        nextEntry.truck_id === entry.truck_id &&
                        nextEntry.ice_type === entry.ice_type &&
                        (nextEntry.timestamp === entry.timestamp || nextEntry.timestamp === entry.timestamp + 1)
                    );
                    
                    if (spoiledEntry) {
                        // **‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢:** ‡∏£‡∏ß‡∏° Log ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô
                        actionText = `<strong style="color: green;">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏Ç‡∏≠‡∏á‡∏î‡∏µ)</strong>`;
                        extraNote = `<div class="log-note">‡∏£‡∏ß‡∏°: ‡πÄ‡∏™‡∏µ‡∏¢ ${spoiledEntry.quantity} ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö | ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö Log ‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡πâ‡∏ß‡∏¢</div>`;
                        renderedLogIds.add(spoiledEntry.id); // ‡∏ã‡πà‡∏≠‡∏ô Log ‡πÄ‡∏™‡∏µ‡∏¢‡∏à‡∏≤‡∏Å Log list
                    } else {
                        // ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢: ‡πÅ‡∏™‡∏î‡∏á Log ‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥
                        actionText = `<strong style="color: green;">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏Ç‡∏≠‡∏á‡∏î‡∏µ)</strong>`;
                    }
                } else if (entry.action === 'OUT') {
                    actionText = `<strong style="color: red;">‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å</strong>`;
                } else if (entry.action === 'ADJ') {
                    actionText = `<strong style="color: orange;">‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</strong>`;
                } else if (entry.action === 'SPOIL') {
                    // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏£‡∏ß‡∏° (‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÇ‡∏î‡∏î‡πÜ) ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô Log ‡πÄ‡∏™‡∏µ‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥
                    actionText = `<strong style="color: purple;">‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡πÄ‡∏™‡∏µ‡∏¢</strong>`; 
                } else if (entry.action === 'FSALE') {
                    actionText = `<strong style="color: blue;">‡∏Ç‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô</strong>`; 
                }

                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ
                if (entry.truck_id === 'ADMIN') {
                    truckInfo = '[ADMIN]';
                } else if (entry.truck_id === 'FACTORY') {
                    truckInfo = '[‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô]';
                } else {
                    truckInfo = `‡∏£‡∏ñ ${entry.truck_id}`;
                }
                
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                
                let entryDetails = `
                    <div style="flex-grow: 1;">
                        [${timeStr}] 
                        ${truckInfo} 
                        ${actionText} ${entry.quantity} ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö 
                        (${entry.ice_type}).
                        ${extraNote}
                    </div>
                    <button class="delete-btn" onclick="deleteLogEntry('${entry.id}')">‡∏•‡∏ö</button>
                `;
                
                logEntry.innerHTML = entryDetails;
                logContainer.appendChild(logEntry);
            });

            if (allLog.length === 0) {
                logContainer.innerHTML = '<p style="text-align: center; color: #6c757d;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß</p>';
            }
        }
        // ----------------------------------------------------
        // ... ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô recordFactorySale, recordTransaction, adjustStock, exportLogToCSV ‡πÅ‡∏•‡∏∞ Initialization (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠) ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ...
        // (‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏ï‡πà‡∏•‡∏π‡∏Å‡∏®‡∏¥‡∏©‡∏¢‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏°‡∏±‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå index.html ‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á)
        // ----------------------------------------------------

        // **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏â‡∏ö‡∏±‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (recordFactorySale, recordTransaction, adjustStock, exportLogToCSV, toggleSpoiledField ‡πÅ‡∏•‡∏∞ Initialization) ‡πÉ‡∏´‡πâ‡∏ô‡∏≥‡∏°‡∏≤‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô <script> ‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        
        // ----------------------------------------------------
        // 6. ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Initialization)
        // ----------------------------------------------------

        if (!localStorage.getItem(STOCK_KEY)) {
            saveStock(INITIAL_STOCK);
        }

        renderStock();
        renderLog();
        toggleSpoiledField(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà

    </script>
</body>
</html>
