<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏à‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        /* ‡∏ã‡πà‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏®‡∏£‡πÉ‡∏ô Input type number */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô SVG (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á Library ‡πÄ‡∏û‡∏¥‡πà‡∏°) ---
        const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;

        // --- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á (Mock Data) ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á ---
        const MOCK_ORDERS = {
            '‡∏£‡∏ñ 1': { '‡∏´‡∏•‡∏≠‡∏î': 50, '‡∏´‡∏¢‡∏≤‡∏ö': 20, '‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î': 0 },
            '‡∏£‡∏ñ 2': { '‡∏´‡∏•‡∏≠‡∏î': 40, '‡∏´‡∏¢‡∏≤‡∏ö': 0, '‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î': 10 },
            '‡∏£‡∏ñ 3': { '‡∏´‡∏•‡∏≠‡∏î': 100, '‡∏´‡∏¢‡∏≤‡∏ö': 50, '‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î': 50 },
            '‡∏£‡∏ñ 4': { '‡∏´‡∏•‡∏≠‡∏î': 20, '‡∏´‡∏¢‡∏≤‡∏ö': 0, '‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î': 0 },
            '‡∏£‡∏ñ 5': { '‡∏´‡∏•‡∏≠‡∏î': 0, '‡∏´‡∏¢‡∏≤‡∏ö': 0, '‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î': 60 },
        };

        const ICE_TYPES = ['‡∏´‡∏•‡∏≠‡∏î', '‡∏´‡∏¢‡∏≤‡∏ö', '‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'];
        const CAR_LIST = ['‡∏£‡∏ñ 1', '‡∏£‡∏ñ 2', '‡∏£‡∏ñ 3', '‡∏£‡∏ñ 4', '‡∏£‡∏ñ 5'];

        function App() {
            // --- State ---
            const [currentTime, setCurrentTime] = useState(new Date());
            const [sackWithdraw, setSackWithdraw] = useState(80); // ‡πÄ‡∏ö‡∏¥‡∏Å‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô
            const [activeTab, setActiveTab] = useState('‡∏´‡∏•‡∏≠‡∏î');

            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î (Transactions)
            // ‡πÉ‡∏ä‡πâ id: Date.now() ‡πÄ‡∏õ‡πá‡∏ô Key ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏õ‡πâ‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏î‡πâ‡∏á‡∏´‡∏≤‡∏¢
            const [transactions, setTransactions] = useState([
                { id: 1, carId: '‡∏£‡∏ñ 1', type: '‡∏´‡∏•‡∏≠‡∏î', fresh: 0, old: 0 }, 
            ]);

            // ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            // --- Logic ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ---
            // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏´‡∏±‡∏Å‡∏•‡∏ö‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö)
            const totalProduced = transactions.reduce((sum, t) => sum + (parseInt(t.fresh) || 0) + (parseInt(t.old) || 0), 0);
            const sacksRemaining = sackWithdraw - totalProduced;

            // 2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
            const addTransaction = () => {
                const newTx = {
                    id: Date.now(), // Unique ID ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!
                    carId: '‡∏£‡∏ñ 1',
                    type: activeTab,
                    fresh: 0,
                    old: 0
                };
                setTransactions([...transactions, newTx]);
            };

            // 3. ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î
            const removeTransaction = (id) => {
                setTransactions(transactions.filter(t => t.id !== id));
            };

            // 4. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)
            const updateTransaction = (id, field, value) => {
                const newValue = value === '' ? '' : parseInt(value); // ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏ö‡πÄ‡∏•‡∏Ç‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å
                
                setTransactions(prev => prev.map(t => {
                    if (t.id === id) {
                        // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô NaN ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
                        return { ...t, [field]: isNaN(newValue) ? '' : newValue };
                    }
                    return t;
                }));
            };

            // 5. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏£‡∏ñ/‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó)
            const updateTransactionMeta = (id, field, value) => {
                setTransactions(prev => prev.map(t => {
                    if (t.id === id) return { ...t, [field]: value };
                    return t;
                }));
            };

            // --- Component ‡∏¢‡πà‡∏≠‡∏¢: ‡∏Å‡∏≤‡∏£‡πå‡∏î ---
            const TransactionCard = ({ data }) => {
                // ‡∏î‡∏∂‡∏á‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
                const targetOrder = MOCK_ORDERS[data.carId]?.[data.type] || 0;

                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Order ‡∏ô‡∏µ‡πâ (‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
                const totalLoadedForThisOrder = transactions
                    .filter(t => t.carId === data.carId && t.type === data.type)
                    .reduce((sum, t) => sum + (parseInt(t.fresh) || 0) + (parseInt(t.old) || 0), 0);

                // ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏î
                const missing = Math.max(0, targetOrder - totalLoadedForThisOrder);
                const isComplete = missing === 0 && targetOrder > 0;
                
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏´‡∏°
                const isOver = totalLoadedForThisOrder > targetOrder && targetOrder > 0;

                // ‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                let statusColor = "bg-orange-500";
                let statusText = `‡∏Ç‡∏≤‡∏î ${missing}`;
                
                if (isComplete) {
                    statusColor = "bg-green-500";
                    statusText = "‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß";
                } else if (isOver) {
                    statusColor = "bg-red-500";
                    statusText = `‡πÄ‡∏Å‡∏¥‡∏ô ${totalLoadedForThisOrder - targetOrder}`;
                } else if (targetOrder === 0) {
                     statusColor = "bg-gray-400";
                     statusText = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå";
                }

                return (
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200 mb-3 relative">
                        {/* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö */}
                        <button 
                            onClick={() => removeTransaction(data.id)}
                            className="absolute top-2 right-2 text-gray-400 hover:text-red-500 p-1"
                        >
                            <IconX />
                        </button>

                        {/* ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏£‡∏ñ / ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó */}
                        <div className="flex gap-2 mb-3 pr-6">
                            <select 
                                className="bg-gray-100 rounded px-2 py-1 text-sm font-bold text-gray-700 outline-none border border-transparent focus:border-green-400"
                                value={data.carId}
                                onChange={(e) => updateTransactionMeta(data.id, 'carId', e.target.value)}
                            >
                                {CAR_LIST.map(car => <option key={car} value={car}>{car}</option>)}
                            </select>

                            <select 
                                className="bg-gray-100 rounded px-2 py-1 text-sm font-bold text-gray-700 outline-none border border-transparent focus:border-green-400"
                                value={data.type}
                                onChange={(e) => updateTransactionMeta(data.id, 'type', e.target.value)}
                            >
                                {ICE_TYPES.map(type => <option key={type} value={type}>{type}</option>)}
                            </select>
                        </div>

                        {/* ‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏™‡∏±‡πà‡∏á / ‡∏Ç‡∏≤‡∏î) - ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç */}
                        <div className={`rounded-full px-4 py-1 text-white text-sm font-bold inline-flex items-center gap-2 mb-4 shadow-sm ${statusColor}`}>
                            <span>‡∏™‡∏±‡πà‡∏á: {targetOrder}</span>
                            <span className="text-white/60">|</span>
                            <span>{statusText}</span>
                        </div>

                        {/* ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */}
                        <div className="flex gap-3">
                            {/* ‡∏™‡∏î */}
                            <div className="flex-1">
                                <div className="text-xs text-gray-500 mb-1 flex items-center gap-1 font-bold">üî• ‡∏™‡∏î</div>
                                <input
                                    type="number"
                                    inputMode="numeric"
                                    pattern="[0-9]*"
                                    className="w-full bg-green-50 border border-green-200 rounded-lg p-3 text-center text-xl font-bold text-gray-700 focus:outline-none focus:ring-2 focus:ring-green-400 transition-all"
                                    value={data.fresh}
                                    placeholder="0"
                                    onChange={(e) => updateTransaction(data.id, 'fresh', e.target.value)}
                                    onFocus={(e) => e.target.select()} 
                                />
                            </div>

                            {/* ‡πÄ‡∏Å‡πà‡∏≤ */}
                            <div className="flex-1">
                                <div className="text-xs text-gray-500 mb-1 flex items-center gap-1 font-bold">‚ùÑÔ∏è ‡πÄ‡∏Å‡πà‡∏≤</div>
                                <input
                                    type="number"
                                    inputMode="numeric"
                                    pattern="[0-9]*"
                                    className="w-full bg-blue-50 border border-blue-200 rounded-lg p-3 text-center text-xl font-bold text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"
                                    value={data.old}
                                    placeholder="0"
                                    onChange={(e) => updateTransaction(data.id, 'old', e.target.value)}
                                    onFocus={(e) => e.target.select()}
                                />
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen pb-24 max-w-md mx-auto relative shadow-2xl bg-gray-50">
                    
                    {/* --- HEADER --- */}
                    <div className="bg-white px-4 pt-4 pb-2 sticky top-0 z-20 shadow-sm rounded-b-2xl">
                        <div className="flex justify-between items-center mb-4">
                            <div className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <span>#1 ‡πÄ‡∏ß‡∏•‡∏≤:</span>
                                <span className="font-mono bg-gray-100 px-2 py-0.5 rounded text-lg">{currentTime.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })}</span>
                            </div>
                            <button className="bg-red-50 text-red-500 px-3 py-1 rounded-lg text-sm font-bold border border-red-100 hover:bg-red-100" onClick={() => setTransactions([])}>‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                        </div>

                        {/* Summary Dashboard */}
                        <div className="bg-orange-50 border border-orange-100 rounded-xl p-3 grid grid-cols-3 text-center gap-2 mb-4 shadow-sm">
                            <div className="flex flex-col justify-center">
                                <div className="text-xs text-orange-600 font-bold mb-1">‡πÄ‡∏ö‡∏¥‡∏Å‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</div>
                                <input 
                                    type="number" 
                                    inputMode="numeric"
                                    className="w-full text-center bg-white border border-orange-200 rounded p-1 font-bold text-gray-800 text-lg focus:outline-none focus:ring-1 focus:ring-orange-300"
                                    value={sackWithdraw}
                                    onChange={(e) => setSackWithdraw(parseInt(e.target.value) || 0)}
                                    onFocus={(e) => e.target.select()}
                                />
                            </div>
                            <div className="flex flex-col justify-center border-l border-orange-200">
                                <div className="text-xs text-orange-600 font-bold mb-1">‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ</div>
                                <div className="text-2xl font-bold text-gray-700">{totalProduced}</div>
                            </div>
                            <div className="flex flex-col justify-center border-l border-orange-200">
                                <div className="text-xs text-orange-600 font-bold mb-1">‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                                <div className={`text-2xl font-bold ${sacksRemaining < 0 ? 'text-red-500' : 'text-green-600'}`}>
                                    {sacksRemaining}
                                </div>
                            </div>
                        </div>

                        {/* Tabs Filter */}
                        <div className="grid grid-cols-3 gap-1 bg-gray-100 p-1 rounded-lg">
                            {ICE_TYPES.map(type => (
                                <button
                                    key={type}
                                    onClick={() => setActiveTab(type)}
                                    className={`py-1.5 text-sm font-bold rounded-md transition-all ${
                                        activeTab === type 
                                        ? 'bg-white text-green-600 shadow-sm' 
                                        : 'text-gray-400 hover:text-gray-600'
                                    }`}
                                >
                                    {type}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* --- CONTENT LIST --- */}
                    <div className="p-4">
                        {transactions.length === 0 && (
                            <div className="text-center py-10 text-gray-400">
                                <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                <p className="text-sm">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° + ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                            </div>
                        )}
                        
                        {transactions.map((tx) => (
                            <TransactionCard key={tx.id} data={tx} />
                        ))}

                        <div className="h-20"></div> {/* Space for FAB */}
                    </div>

                    {/* --- FLOATING ACTION BUTTON --- */}
                    <button 
                        onClick={addTransaction}
                        className="fixed bottom-6 right-6 bg-green-500 text-white w-14 h-14 rounded-full shadow-lg hover:bg-green-600 hover:scale-105 transition-all flex items-center justify-center z-30 focus:outline-none focus:ring-4 focus:ring-green-300/50"
                    >
                        <IconPlus />
                    </button>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
