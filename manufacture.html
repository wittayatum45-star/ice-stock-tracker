<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ultimate Ice Stock Tracker V6</title>
    <style>
        /* --- CSS Global --- */
        body { font-family: Tahoma, sans-serif; margin: 0; padding: 10px; background: #f0f2f5; font-size: 14px; color: #333; }
        .container { 
            width: 98%; 
            max-width: 1250px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏Ç‡∏≤ */
            margin: 10px auto; 
            padding: 15px; 
            background: white; 
            border: 2px solid #333; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            overflow-x: auto; /* ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤‡πÑ‡∏î‡πâ */
        }
        
        /* --- Styles: ‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô/‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏ô‡πâ‡∏≤ (Page) --- */
        .page { display: none; } 
        .page.active { display: block; }

        /* --- Styles: ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ --- */
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 0.9em; table-layout: fixed; }
        th, td { border: 1px solid #000; padding: 4px 1px; text-align: center; vertical-align: middle; height: 30px; white-space: nowrap; } /* white-space: nowrap ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà */
        th { background: #dcdcdc; font-weight: bold; position: sticky; top: 0; z-index: 10; } /* sticky header */
        
        input[type="number"] {
            width: 100%;
            padding: 4px 1px;
            border: none;
            box-sizing: border-box;
            font-size: 1.0em;
            text-align: center;
            background: #fff8e1; /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô‡πÜ ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å */
            -moz-appearance: textfield; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏•‡∏á‡πÉ‡∏ô Firefox */
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none; 
            margin: 0;
        }

        input[type="text"], input[type="date"], select { 
            width: 100%;
            padding: 5px 2px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            font-size: 1.0em;
            text-align: center;
        }
        button {
            padding: 10px 15px;
            font-size: 1.1em;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }
        button.nav-btn { background: #6c757d; }
        button.save-btn { background: #28a745; }

        /* --- Styles: ‡∏´‡∏ô‡πâ‡∏≤ 1 (Master Order) --- */
        #page-master-order input[type="number"] { background: #fdfde7; }
        #page-master-order input[type="text"] { background: #e0f7fa; }

        /* --- Styles: ‡∏´‡∏ô‡πâ‡∏≤ 2 (Fulfillment) --- */
        .control-panel { display: flex; gap: 10px; margin-bottom: 10px; }
        .control-group { flex: 1; }

        /* Styles: Header ‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á */
        #master-order-header {
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            border: 2px solid #333;
            background: #f5f5f5;
        }
        .header-box { font-size: 1.0em; text-align: center; } 
        .header-box label { font-weight: bold; display: block; margin-bottom: 3px; } 
        .header-value { font-weight: 900; color: #004d40; font-size: 1.2em; display: block; } 
        
        /* üî• Styles: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á V5 (‡∏™‡∏µ‡∏™‡∏±‡∏ô‡∏™‡∏î‡πÉ‡∏™) üî• */
        #fulfillment-matrix { min-width: 1200px; } /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏°‡∏µ scroll bar ‡∏ñ‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
        
        /* ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô (‡∏ï‡∏π‡πâ) / ‡∏™‡∏µ‡πÅ‡∏î‡∏á (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á) */
        .input-blue { background-color: #e0f2f7 !important; } 
        .input-red { background-color: #ffe0e0 !important; }

        /* üî• ‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á üî• */
        .hl-group { background-color: #e3f2fd; } /* ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô - ‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà */
        .bh-group { background-color: #e8f5e9; } /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô - ‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö */
        .bl-group { background-color: #fff3e0; } /* ‡∏™‡πâ‡∏°‡∏≠‡πà‡∏≠‡∏ô - ‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î */

        /* üî• ‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á "‡∏£‡∏ß‡∏°" ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏≤ üî• */
        .leg-total {
            background-color: #bbdefb; /* ‡∏ü‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô */
            font-weight: bold;
            font-size: 1.0em;
        }
        .leg-total.bh-group { background-color: #c8e6c9; } /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô */
        .leg-total.bl-group { background-color: #ffe0b2; } /* ‡∏™‡πâ‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô */


        /* "‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡∏Å" (Footer) */
        #fulfillment-matrix tfoot td {
            background: #dcedc8; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô */
            font-weight: 900;
            font-size: 1.1em;
        }
        /* "‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î (4 ‡∏ä‡πà‡∏≠‡∏á)" */
        #total_hl_all_sources { background-color: #90caf9; } /* ‡∏ü‡πâ‡∏≤‡∏Å‡∏•‡∏≤‡∏á */
        #total_bh_all_sources { background-color: #a5d6a7; } /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏Å‡∏•‡∏≤‡∏á */
        #total_bl_all_sources { background-color: #ffcc80; } /* ‡∏™‡πâ‡∏°‡∏Å‡∏•‡∏≤‡∏á */

        /* "‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" (‡πÉ‡∏´‡∏°‡πà) */
        #grand_total_all_types {
            background-color: #c5cae9; /* ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô */
            font-weight: 900;
            font-size: 1.2em;
            color: #3f51b5;
        }

        /* "‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠" (‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏¢‡∏≠‡∏î) */
        .remaining-row td {
            background: #fff8e1; 
            font-weight: 900;
            font-size: 1.1em;
        }
        .remaining-qty { color: #d32f2f; } 
        .remaining-qty.complete { color: #2e7d32; } 

        /* ‡πÉ‡∏´‡πâ header ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô ‡∏ï‡∏π‡πâ1/‡∏ï‡∏π‡πâ2 ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
        #fulfillment-matrix thead th.sub-header { font-size: 0.85em; padding: 2px 0; }
    </style>
</head>
<body>

    <div id="page-master-order" class="page active">
        <div class="container">
            <h2>‡∏´‡∏ô‡πâ‡∏≤ 1: üìã ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Master Order (‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å)</h2>
            <p style="color: red; font-weight: bold;">‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ!</p>
            
            <table>
                <thead>
                    <tr>
                        <th>W-ID</th>
                        <th>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö (‡∏ä‡∏∑‡πà‡∏≠)</th>
                        <th>‡∏™‡∏≤‡∏¢ (‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á)</th>
                        <th>‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà (HL)</th>
                        <th>‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö (BH)</th>
                        <th>‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (BL)</th>
                    </tr>
                </thead>
                <tbody id="master-order-input-body">
                    <tr>
                        <td>W041-001</td>
                        <td><input type="text" id="master_name_001" value="‡∏ô‡∏≤‡∏¢‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡∏ß‡∏µ ‡∏ä‡∏π‡∏£‡∏∞‡∏™‡∏∏‡∏Ç"></td>
                        <td><input type="text" id="master_route_001" value="‡∏î‡∏≠‡∏ô‡∏â‡πà‡∏≥‡∏Ñ‡πâ‡∏≤"></td>
                        <td><input type="number" id="master_hl_001" value="65"></td>
                        <td><input type="number" id="master_bh_001" value="41"></td>
                        <td><input type="number" id="master_bl_001" value="2"></td>
                    </tr>
                    <tr><td>W041-002</td><td><input type="text" id="master_name_002" value="‡∏ô‡∏≤‡∏¢‡∏ß‡∏£‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏û‡∏£‡∏´‡∏°‡∏ä‡∏≤‡∏ï‡∏¥"></td><td><input type="text" id="master_route_002" value="‡πÇ‡∏û‡∏ô‡∏á‡∏≤‡∏°"></td><td><input type="number" id="master_hl_002" value="65"></td><td><input type="number" id="master_bh_002" value="30"></td><td><input type="number" id="master_bl_002" value="13"></td></tr>
                    <tr><td>W041-003</td><td><input type="text" id="master_name_003" value="‡∏ô‡∏≤‡∏¢‡πÇ‡∏û‡∏ò‡∏¥‡πå ‡∏õ‡πâ‡∏≠‡∏á‡∏à‡∏ß‡∏á‡∏•‡∏≤"></td><td><input type="text" id="master_route_003" value="‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏°‡πâ‡∏≠"></td><td><input type="number" id="master_hl_003" value="65"></td><td><input type="number" id="master_bh_003" value="35"></td><td><input type="number" id="master_bl_003" value="8"></td></tr>
                    <tr><td>W041-004</td><td><input type="text" id="master_name_004" value="‡∏ô‡∏≤‡∏¢‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏ä‡∏±‡∏¢ ‡πÇ‡∏™‡∏°‡∏≤‡∏ß‡∏±‡∏ï‡∏£"></td><td><input type="text" id="master_route_004" value="‡πÇ‡∏Ñ‡∏Å‡∏™‡∏ß‡πà‡∏≤‡∏á"></td><td><input type="number" id="master_hl_004" value="50"></td><td><input type="number" id="master_bh_004" value="50"></td><td><input type="number" id="master_bl_004" value="8"></td></tr>
                    <tr><td>W041-005</td><td><input type="text" id="master_name_005" value="‡∏ô‡∏≤‡∏¢‡∏ó‡∏£‡∏á‡∏¢‡∏® ‡∏¢‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô"></td><td><input type="text" id="master_route_005" value="‡∏´‡∏ô‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ö"></td><td><input type="number" id="master_hl_005" value="70"></td><td><input type="number" id="master_bh_005" value="23"></td><td><input type="number" id="master_bl_005" value="15"></td></tr>
                    <tr><td>W041-006</td><td><input type="text" id="master_name_006" value="‡∏ô‡∏≤‡∏¢‡∏≠‡πÑ‡∏ó‡∏û‡∏£ ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á"></td><td><input type="text" id="master_route_006" value="‡∏à‡∏≠‡∏°‡∏®‡∏£‡∏µ"></td><td><input type="number" id="master_hl_006" value="60"></td><td><input type="number" id="master_bh_006" value="43"></td><td><input type="number" id="master_bl_006" value="5"></td></tr>
                    <tr><td>W041-007</td><td><input type="text" id="master_name_007" value="‡∏ô‡∏≤‡∏¢‡∏ä‡∏±‡∏¢‡∏ì‡∏£‡∏á‡∏Ñ‡πå ‡∏û‡∏•‡∏ã‡∏∏‡πâ‡∏¢"></td><td><input type="text" id="master_route_007" value="‡∏î‡∏á‡∏≠‡πâ‡∏ô"></td><td><input type="number" id="master_hl_007" value="70"></td><td><input type="number" id="master_bh_007" value="32"></td><td><input type="number" id="master_bl_007" value="6"></td></tr>
                    <tr><td>W041-008</td><td><input type="text" id="master_name_008" value="‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏û‡∏á‡∏®‡πå ‡∏ß‡∏á‡∏©‡πå‡∏î‡∏µ"></td><td><input type="text" id="master_route_008" value="‡∏´‡∏°‡∏π‡πà‡∏°‡πà‡∏ô"></td><td><input type="number" id="master_hl_008" value="70"></td><td><input type="number" id="master_bh_008" value="28"></td><td><input type="number" id="master_bl_008" value="10"></td></tr>
                    <tr><td>W041-009</td><td><input type="text" id="master_name_009" value="‡∏ô‡∏≤‡∏¢‡∏ò‡∏ô‡∏¢‡∏®‡∏ä‡∏≤ ‡πÅ‡∏Å‡πâ‡∏ß‡∏™‡∏≠‡∏ô‡∏î‡∏µ"></td><td><input type="text" id="master_route_009" value="‡∏î‡∏≠‡∏ô‡πÅ‡∏û‡∏á"></td><td><input type="number" id="master_hl_009" value="70"></td><td><input type="number" id="master_bh_009" value="20"></td><td><input type="number" id="master_bl_009" value="8"></td></tr>
                </tbody>
            </table>
            
            <button id="save-master-list-btn" class="save-btn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Master List (‡∏•‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)</button>
            <button id="go-to-fulfillment-btn" class="nav-btn">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á (‡∏´‡∏ô‡πâ‡∏≤ 2) ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="page-fulfillment" class="page">
        <div class="container">
            <h2>‡∏´‡∏ô‡πâ‡∏≤ 2: üöö ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á (Fulfillment)</h2>
            <button id="go-to-master-btn" class="nav-btn">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ Master List (‡∏´‡∏ô‡πâ‡∏≤ 1)</button>
            
            <div class="control-panel">
                <div class="control-group">
                    <label for="date_select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà üóìÔ∏è</label>
                    <input type="date" id="date_select">
                </div>
                <div class="control-group">
                    <label for="truck_select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ üöö</label>
                    <select id="truck_select">
                        <option value="‡∏£‡∏ñ 1">‡∏£‡∏ñ 1 (W041-001)</option>
                        <option value="‡∏£‡∏ñ 2">‡∏£‡∏ñ 2 (W041-002)</option>
                        <option value="‡∏£‡∏ñ 3">‡∏£‡∏ñ 3 (W041-003)</option>
                        <option value="‡∏£‡∏ñ 4">‡∏£‡∏ñ 4 (W041-004)</option>
                        <option value="‡∏£‡∏ñ 5">‡∏£‡∏ñ 5 (W041-005)</option>
                        <option value="‡∏£‡∏ñ 6">‡∏£‡∏ñ 6 (W041-006)</option>
                        <option value="‡∏£‡∏ñ 7">‡∏£‡∏ñ 7 (W041-007)</option>
                        <option value="‡∏£‡∏ñ 8">‡∏£‡∏ñ 8 (W041-008)</option>
                        <option value="‡∏£‡∏ñ 9">‡∏£‡∏ñ 9 (W041-009)</option>
                    </select>
                </div>
            </div>

            <div id="master-order-header">
                <div class="header-box">
                    <label>W-ID:</label> <span id="header_wid" class="header-value">-</span>
                </div>
                <div class="header-box">
                    <label>‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á (‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà):</label> <span id="header_hl" class="header-value">0</span>
                </div>
                <div class="header-box">
                    <label>‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á (‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö):</label> <span id="header_bh" class="header-value">0</span>
                </div>
                 <div class="header-box">
                    <label>‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á (‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î):</label> <span id="header_bl" class="header-value">0</span>
                </div>
            </div>

            <table id="fulfillment-matrix">
                <thead>
                    <tr>
                        <th rowspan="3" style="width: 5%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                        <th colspan="5" class="hl-group">‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà</th>
                        <th colspan="5" class="bh-group">‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö</th>
                        <th colspan="5" class="bl-group">‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                    </tr>
                    <tr>
                        <th colspan="2" class="sub-header hl-group">‡∏ï‡∏π‡πâ 1</th>
                        <th colspan="2" class="sub-header hl-group">‡∏ï‡∏π‡πâ 2</th>
                        <th rowspan="2" class="leg-total hl-group">‡∏£‡∏ß‡∏°</th> 
                        <th colspan="2" class="sub-header bh-group">‡∏ï‡∏π‡πâ 1</th>
                        <th colspan="2" class="sub-header bh-group">‡∏ï‡∏π‡πâ 2</th>
                        <th rowspan="2" class="leg-total bh-group">‡∏£‡∏ß‡∏°</th> 
                        <th colspan="2" class="sub-header bl-group">‡∏ï‡∏π‡πâ 1</th>
                        <th colspan="2" class="sub-header bl-group">‡∏ï‡∏π‡πâ 2</th>
                        <th rowspan="2" class="leg-total bl-group">‡∏£‡∏ß‡∏°</th> 
                    </tr>
                    <tr>
                        <th style="width: 4%;" class="hl-group">‡∏ü‡πâ‡∏≤</th>
                        <th style="width: 4%;" class="hl-group">‡πÅ‡∏î‡∏á</th>
                        <th style="width: 4%;" class="hl-group">‡∏ü‡πâ‡∏≤</th>
                        <th style="width: 4%;" class="hl-group">‡πÅ‡∏î‡∏á</th>
                        <th style="width: 4%;" class="bh-group">‡∏ü‡πâ‡∏≤</th>
                        <th style="width: 4%;" class="bh-group">‡πÅ‡∏î‡∏á</th>
                        <th style="width: 4%;" class="bh-group">‡∏ü‡πâ‡∏≤</th>
                        <th style="width: 4%;" class="bh-group">‡πÅ‡∏î‡∏á</th>
                        <th style="width: 4%;" class="bl-group">‡∏ü‡πâ‡∏≤</th>
                        <th style="width: 4%;" class="bl-group">‡πÅ‡∏î‡∏á</th>
                        <th style="width: 4%;" class="bl-group">‡∏ü‡πâ‡∏≤</th>
                        <th style="width: 4%;" class="bl-group">‡πÅ‡∏î‡∏á</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="font-weight: bold;">‡∏Ç‡∏≤‡∏ó‡∏µ‡πà 1</td>
                        <td><input type="number" id="hl_leg1_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg1_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg1_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg1_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total hl-group" id="hl_leg1_total">0</td>
                        <td><input type="number" id="bh_leg1_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg1_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg1_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg1_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total bh-group" id="bh_leg1_total">0</td>
                        <td><input type="number" id="bl_leg1_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg1_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg1_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg1_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total bl-group" id="bl_leg1_total">0</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">‡∏Ç‡∏≤‡∏ó‡∏µ‡πà 2</td>
                        <td><input type="number" id="hl_leg2_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg2_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg2_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg2_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total hl-group" id="hl_leg2_total">0</td>
                        <td><input type="number" id="bh_leg2_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg2_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg2_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg2_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total bh-group" id="bh_leg2_total">0</td>
                        <td><input type="number" id="bl_leg2_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg2_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg2_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg2_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total bl-group" id="bl_leg2_total">0</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">‡∏Ç‡∏≤‡∏ó‡∏µ‡πà 3</td>
                        <td><input type="number" id="hl_leg3_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg3_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg3_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg3_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total hl-group" id="hl_leg3_total">0</td>
                        <td><input type="number" id="bh_leg3_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg3_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg3_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg3_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total bh-group" id="bh_leg3_total">0</td>
                        <td><input type="number" id="bl_leg3_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg3_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg3_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg3_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total bl-group" id="bl_leg3_total">0</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">‡∏Ç‡∏≤‡∏ó‡∏µ‡πà 4</td>
                        <td><input type="number" id="hl_leg4_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg4_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg4_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="hl_leg4_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total hl-group" id="hl_leg4_total">0</td>
                        <td><input type="number" id="bh_leg4_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg4_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg4_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bh_leg4_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total bh-group" id="bh_leg4_total">0</td>
                        <td><input type="number" id="bl_leg4_t1_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg4_t1_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg4_t2_blue" class="input-blue" value="0" inputmode="numeric"></td>
                        <td><input type="number" id="bl_leg4_t2_red" class="input-red" value="0" inputmode="numeric"></td>
                        <td class="leg-total bl-group" id="bl_leg4_total">0</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td style="font-weight: bold;">‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡∏Å</td> <td id="footer_hl_t1_blue" class="hl-group">0</td>
                        <td id="footer_hl_t1_red" class="hl-group">0</td>
                        <td id="footer_hl_t2_blue" class="hl-group">0</td>
                        <td id="footer_hl_t2_red" class="hl-group">0</td>
                        <td id="footer_hl_total" class="hl-group">0</td>
                        <td id="footer_bh_t1_blue" class="bh-group">0</td>
                        <td id="footer_bh_t1_red" class="bh-group">0</td>
                        <td id="footer_bh_t2_blue" class="bh-group">0</td>
                        <td id="footer_bh_t2_red" class="bh-group">0</td>
                        <td id="footer_bh_total" class="bh-group">0</td>
                        <td id="footer_bl_t1_blue" class="bl-group">0</td>
                        <td id="footer_bl_t1_red" class="bl-group">0</td>
                        <td id="footer_bl_t2_blue" class="bl-group">0</td>
                        <td id="footer_bl_t2_red" class="bl-group">0</td>
                        <td id="footer_bl_total" class="bl-group">0</td>
                    </tr>
                    <tr class="remaining-row">
                        <td style="font-weight: bold;">‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î (4 ‡∏ä‡πà‡∏≠‡∏á)</td>
                        <td colspan="5" id="total_hl_all_sources" class="hl-group">0</td>
                        <td colspan="5" id="total_bh_all_sources" class="bh-group">0</td>
                        <td colspan="5" id="total_bl_all_sources" class="bl-group">0</td>
                    </tr>
                    
                    <tr class="remaining-row">
                        <td style="font-weight: bold;">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏™‡∏±‡πà‡∏á - ‡πÄ‡∏ö‡∏¥‡∏Å)</td>
                        <td colspan="5" id="remaining_hl" class="remaining-qty hl-group">0</td>
                        <td colspan="5" id="remaining_bh" class="remaining-qty bh-group">0</td>
                        <td colspan="5" id="remaining_bl" class="remaining-qty bl-group">0</td>
                    </tr>
                    <tr class="remaining-row">
                        <td style="font-weight: bold;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td> <td colspan="15" id="grand_total_all_types">0</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

<script>
    // üî• "‡∏™‡∏°‡∏≠‡∏á" ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ V6 (JavaScript) - Colorful & Summarized! üî•

    // --- ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ID (W-ID <-> ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏ñ) ---
    const TRUCK_MAP = {
        "‡∏£‡∏ñ 1": "W041-001", "‡∏£‡∏ñ 2": "W041-002", "‡∏£‡∏ñ 3": "W041-003",
        "‡∏£‡∏ñ 4": "W041-004", "‡∏£‡∏ñ 5": "W041-005", "‡∏£‡∏ñ 6": "W041-006",
        "‡∏£‡∏ñ 7": "W041-007", "‡∏£‡∏ñ 8": "W041-008", "‡∏£‡∏ñ 9": "W041-009"
    };
    const MASTER_TRUCK_IDS = Object.values(TRUCK_MAP); // ["W041-001", ...]
    const FULFILL_ICE_TYPES = ['hl', 'bh', 'bl'];
    const FULFILL_LEGS = ['1', '2', '3', '4']; // ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 4 ‡∏Ç‡∏≤
    const FULFILL_CONTAINERS = ['t1', 't2']; // ‡∏ï‡∏π‡πâ 1, ‡∏ï‡∏π‡πâ 2
    const FULFILL_SOURCES = ['blue', 'red']; // ‡∏ü‡πâ‡∏≤ (‡∏ï‡∏π‡πâ), ‡πÅ‡∏î‡∏á (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)

    // --- ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° ID Inputs ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠ Save/Load State ---
    const allMasterInputIds = [];
    MASTER_TRUCK_IDS.forEach(id => {
        const numId = id.split('-')[1]; // "001"
        allMasterInputIds.push(`master_name_${numId}`);
        allMasterInputIds.push(`master_route_${numId}`);
        allMasterInputIds.push(`master_hl_${numId}`);
        allMasterInputIds.push(`master_bh_${numId}`);
        allMasterInputIds.push(`master_bl_${numId}`);
    });
    
    const allFulfillInputIds = []; // ID ‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á "‡∏Å‡∏£‡∏≠‡∏Å" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    FULFILL_LEGS.forEach(leg => {
        FULFILL_ICE_TYPES.forEach(type => {
            FULFILL_CONTAINERS.forEach(container => {
                FULFILL_SOURCES.forEach(source => {
                    allFulfillInputIds.push(`${type}_leg${leg}_${container}_${source}`); // "hl_leg1_t1_blue"
                });
            });
        });
    });

    // --- Utility Functions (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏¢) ---
    function getEl(id) { return document.getElementById(id); }
    function getVal(id) { return getEl(id).value; }
    function setVal(id, value) { getEl(id).value = value; }
    function setHTML(id, html) { getEl(id).innerHTML = html; }
    function getNum(id) { return parseFloat(getVal(id)) || 0; }
    function getNumFromHTML(id) { return parseFloat(getEl(id).textContent) || 0; }

    // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á (Navigation) ---
    document.addEventListener('DOMContentLoaded', () => {
        const pageMaster = getEl('page-master-order');
        const pageFulfill = getEl('page-fulfillment');

        // üî• ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°) üî•
        getEl('go-to-fulfillment-btn').onclick = () => {
            pageMaster.classList.remove('active');
            pageFulfill.classList.add('active');
            switchLog(); 
        };
        getEl('go-to-master-btn').onclick = () => {
            pageFulfill.classList.remove('active');
            pageMaster.classList.add('active');
        };

        // --- Setup ‡∏´‡∏ô‡πâ‡∏≤ 1 (Master) ---
        getEl('save-master-list-btn').onclick = saveMasterList;
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Master ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        loadMasterList(); 

        // --- Setup ‡∏´‡∏ô‡πâ‡∏≤ 2 (Fulfillment) ---
        const dateSelect = getEl('date_select');
        dateSelect.value = new Date().toISOString().split('T')[0]; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        
        // "‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå" ‡∏´‡∏•‡∏±‡∏Å: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏ñ
        dateSelect.onchange = switchLog;
        getEl('truck_select').onchange = switchLog;
        
        // "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì": ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å
        allFulfillInputIds.forEach(id => {
            const inputEl = getEl(id);
            inputEl.oninput = calculate; // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå
            
            inputEl.onfocus = (event) => { // üî• ‡πÄ‡∏•‡∏Ç 0 ‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå üî•
                if (event.target.value === '0') {
                    event.target.value = '';
                }
            };
            inputEl.onblur = (event) => { // üî• ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏ñ‡πâ‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á üî•
                if (event.target.value === '') {
                    event.target.value = '0';
                }
                calculate(); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á
            };
        });

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ 1)
        if (!localStorage.getItem('MASTER_ORDERS_DB_V6')) { // üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ DB Key V6 üî•
            saveMasterList(true); // true = ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ
        }
        // switchLog(); // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°... ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤ 1 ‡πÄ‡∏õ‡πá‡∏ô default
    });

    // --- "‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡∏´‡∏ô‡πâ‡∏≤ 1 (Master Order) ---
    function saveMasterList(silent = false) {
        const masterDB = {};
        MASTER_TRUCK_IDS.forEach(id => {
            const numId = id.split('-')[1]; // "001"
            masterDB[id] = {
                name: getVal(`master_name_${numId}`),
                route: getVal(`master_route_${numId}`),
                hl: getNum(`master_hl_${numId}`),
                bh: getNum(`master_bh_${numId}`),
                bl: getNum(`master_bl_${numId}`)
            };
        });
        
        localStorage.setItem('MASTER_ORDERS_DB_V6', JSON.stringify(masterDB)); // üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ DB Key V6 üî•
        if (!silent) {
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Master List ‡∏•‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß!');
        }
    }

    function loadMasterList() {
        const db = localStorage.getItem('MASTER_ORDERS_DB_V6'); // üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ DB Key V6 üî•
        if (!db) return; 
        
        const masterDB = JSON.parse(db);
        MASTER_TRUCK_IDS.forEach(id => {
            const order = masterDB[id];
            if (order) {
                const numId = id.split('-')[1];
                setVal(`master_name_${numId}`, order.name);
                setVal(`master_route_${numId}`, order.route);
                setVal(`master_hl_${numId}`, order.hl);
                setVal(`master_bh_${numId}`, order.bh);
                setVal(`master_bl_${numId}`, order.bl);
            }
        });
    }

    // --- "‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡∏´‡∏ô‡πâ‡∏≤ 2 (Fulfillment) ---
    function generateLogKey() {
        const date = getVal('date_select');
        const truckName = getVal('truck_select');
        const truckId = TRUCK_MAP[truckName] || "UNKNOWN";
        return `fulfill_v6_${date}_${truckId}`; // üî• Key ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö V6 üî•
    }

    function saveFulfillmentState() {
        const logKey = generateLogKey();
        const state = {};
        allFulfillInputIds.forEach(id => {
            state[id] = getVal(id);
        });
        localStorage.setItem(logKey, JSON.stringify(state));
    }

    function loadFulfillmentState(logKey) {
        allFulfillInputIds.forEach(id => setVal(id, '0'));
        const stateJSON = localStorage.getItem(logKey);
        if (stateJSON) {
            const state = JSON.parse(stateJSON);
            allFulfillInputIds.forEach(id => {
                if (state[id] !== undefined) {
                    setVal(id, state[id]);
                }
            });
        }
    }

    // --- "‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå" ‡∏´‡∏•‡∏±‡∏Å (Fulfillment) ---
    function switchLog() {
        const logKey = generateLogKey();
        
        // 1. üî• ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ "‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏¢‡∏≠‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å" ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! üî•
        const masterDB = JSON.parse(localStorage.getItem('MASTER_ORDERS_DB_V6') || '{}');
        const selectedTruckName = getVal('truck_select');
        const truckId = TRUCK_MAP[selectedTruckName];
        const order = masterDB[truckId];
        
        if (order) {
            // üî• ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï "Header V4" (‡∏ï‡∏±‡∏î‡∏ä‡∏∑‡πà‡∏≠/‡∏™‡∏≤‡∏¢ ‡∏≠‡∏≠‡∏Å) üî•
            setHTML('header_wid', truckId);
            setHTML('header_hl', order.hl);
            setHTML('header_bh', order.bh);
            setHTML('header_bl', order.bl);
        } else {
            // "‡∏ï‡∏±‡∏ß‡∏î‡∏±‡∏Å‡∏ö‡∏±‡πä‡∏Å" (‡∏ñ‡πâ‡∏≤‡∏•‡∏∑‡∏°‡∏Å‡∏î "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ 1)
            if(getEl('page-fulfillment').classList.contains('active')) { // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤ 2 ‡∏à‡∏£‡∏¥‡∏á‡πÜ
                alert("‡πÑ‡∏°‡πà‡∏û‡∏ö Master Order! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ '‡∏´‡∏ô‡πâ‡∏≤ 1' ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å' ‡∏Å‡πà‡∏≠‡∏ô!");
            }
            setHTML('header_wid', "Error!");
            setHTML('header_hl', 0); setHTML('header_bh', 0); setHTML('header_bl', 0);
        }

        // 2. ‡πÇ‡∏´‡∏•‡∏î Fulfillment State (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ)
        loadFulfillmentState(logKey);
        
        // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
        calculate();
    }

    // --- "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì" V6 (Fulfillment) ---
    function calculate() {
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á "‡∏ñ‡∏±‡∏á" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°
        let grandTotal = {};
        let grandTotalAll = 0; // ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        FULFILL_ICE_TYPES.forEach(type => {
            grandTotal[type] = {
                t1_blue: 0, t1_red: 0,
                t2_blue: 0, t2_red: 0,
                totalSum: 0 // (‡∏£‡∏ß‡∏° 4 ‡∏ä‡πà‡∏≠‡∏á)
            };
        });

        // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì "‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô" (‡∏£‡∏ß‡∏° 4 ‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏≤)
        FULFILL_LEGS.forEach(leg => { // '1' ‡∏ñ‡∏∂‡∏á '4'
            FULFILL_ICE_TYPES.forEach(type => { // 'hl', 'bh', 'bl'
                let legTotal = 0;
                FULFILL_CONTAINERS.forEach(container => { // 't1', 't2'
                    FULFILL_SOURCES.forEach(source => { // 'blue', 'red'
                        const id = `${type}_leg${leg}_${container}_${source}`;
                        const val = getNum(id);
                        legTotal += val;
                        // ‡∏ö‡∏ß‡∏Å‡∏™‡∏∞‡∏™‡∏°‡∏¢‡∏≠‡∏î "‡∏£‡∏ß‡∏°" (‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á)
                        grandTotal[type][`${container}_${source}`] += val;
                    });
                });
                // üî• ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï "‡∏£‡∏ß‡∏°" ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡πÜ üî•
                setHTML(`${type}_leg${leg}_total`, legTotal);
            });
        });

        // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï "Footer" (‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡∏Å)
        FULFILL_ICE_TYPES.forEach(type => {
            // ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î 4 ‡∏ä‡πà‡∏≠‡∏á
            const totalSum = grandTotal[type].t1_blue + grandTotal[type].t1_red + 
                             grandTotal[type].t2_blue + grandTotal[type].t2_red;
            grandTotal[type].totalSum = totalSum;
            grandTotalAll += totalSum; // ‡∏ö‡∏ß‡∏Å‡∏™‡∏∞‡∏™‡∏°‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï "‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡∏Å" (‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î)
            setHTML(`footer_${type}_t1_blue`, grandTotal[type].t1_blue);
            setHTML(`footer_${type}_t1_red`, grandTotal[type].t1_red);
            setHTML(`footer_${type}_t2_blue`, grandTotal[type].t2_blue);
            setHTML(`footer_${type}_t2_red`, grandTotal[type].t2_red);
            setHTML(`footer_${type}_total`, totalSum); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏ß‡∏° (‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á)
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï "‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î (4 ‡∏ä‡πà‡∏≠‡∏á)"
            setHTML(`total_${type}_all_sources`, totalSum);
        });
        
        // üî• ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï "‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" (‡πÉ‡∏´‡∏°‡πà) üî•
        setHTML('grand_total_all_types', grandTotalAll);

        // 3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï "‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠" (‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏¢‡∏≠‡∏î Master)
        FULFILL_ICE_TYPES.forEach(type => {
            const masterQty = getNumFromHTML(`header_${type}`);
            const remaining = masterQty - grandTotal[type].totalSum;
            
            const remainingEl = getEl(`remaining_${type}`);
            setHTML(`remaining_${type}`, remaining);
            // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏ö/‡πÄ‡∏Å‡∏¥‡∏ô (<= 0) ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
            remainingEl.classList.toggle('complete', remaining <= 0); 
        });
        
        // 4. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏á `localStorage`
        saveFulfillmentState();
    }
</script>
</body>
</html>
