<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master-Fulfill System V2</title>
    <style>
        /* --- CSS Global --- */
        body { font-family: Tahoma, sans-serif; margin: 0; padding: 10px; background: #f0f2f5; font-size: 14px; color: #333; }
        .container { 
            width: 98%; 
            max-width: 900px; 
            margin: 10px auto; 
            padding: 15px; 
            background: white; 
            border: 2px solid #333; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            overflow-x: auto; 
        }
        
        /* --- Styles: ‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô/‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏ô‡πâ‡∏≤ (Page) --- */
        .page { display: none; } /* ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
        .page.active { display: block; } /* ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ class 'active' */

        /* --- Styles: ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ --- */
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 0.9em; }
        th, td { border: 1px solid #000; padding: 4px 2px; text-align: center; vertical-align: middle; }
        th { background: #dcdcdc; font-weight: bold; }
        input[type="text"], input[type="number"], input[type="date"], select {
            width: 100%;
            padding: 5px 2px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            font-size: 1.0em;
            text-align: center;
        }
        button {
            padding: 10px 15px;
            font-size: 1.1em;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }
        button.nav-btn { background: #6c757d; }
        button.save-btn { background: #28a745; }
        
        /* --- Styles: ‡∏´‡∏ô‡πâ‡∏≤ 1 (Master Order) --- */
        #page-master-order input[type="number"] { background: #fdfde7; }
        #page-master-order input[type="text"] { background: #e0f7fa; }
        #page-master-order th:nth-child(1) { width: 12%; } /* W-ID */
        #page-master-order th:nth-child(2) { width: 25%; } /* ‡∏ä‡∏∑‡πà‡∏≠ */
        #page-master-order th:nth-child(3) { width: 20%; } /* ‡∏™‡∏≤‡∏¢ */

        /* --- Styles: ‡∏´‡∏ô‡πâ‡∏≤ 2 (Fulfillment) --- */
        #master-order-summary { 
            background: #fffbe6; 
            border: 2px solid #f9a825; 
            padding: 10px; 
            margin-bottom: 10px; 
            border-radius: 5px; 
        }
        #master-order-summary h3 { margin: 0 0 10px 0; }
        #master-order-summary td { background: #fff; }
        #master-order-summary .remaining-qty { font-weight: 900; font-size: 1.2em; color: #d32f2f; }
        #master-order-summary .remaining-qty.complete { color: #2e7d32; }

        /* üî• Styles: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á (Blue/Red) üî• */
        #fulfillment-table th:nth-child(1) { width: 15%; } /* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ */
        #fulfillment-table input { 
            width: 100%; 
            padding: 4px 0; 
            text-align: center;
            border: none;
            font-size: 1.0em;
        }
        .input-blue { background-color: #e0f7fa; } /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ (‡∏ï‡∏π‡πâ) */
        .input-red { background-color: #ffebee; } /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á) */
        
        #fulfillment-table tfoot td { background: #f5f5f5; font-weight: bold; font-size: 1.1em; }
        /* üî• Style: ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô 36 ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö üî• */
        .leg-total-warn {
            background-color: #d32f2f !important;
            color: white;
            font-weight: 900;
        }
        
        .control-panel { display: flex; gap: 20px; margin-bottom: 10px; }
        .control-group { flex: 1; }
    </style>
</head>
<body>

    <div id="page-master-order" class="page active">
        <div class="container">
            <h2>‡∏´‡∏ô‡πâ‡∏≤ 1: üìã ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Master Order (‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å)</h2>
            <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ "‡∏£‡∏ß‡∏°" ‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏±‡∏ô‡∏ï‡∏≤‡∏° "‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å" (‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 3)</p>
            
            <table>
                <thead>
                    <tr>
                        <th>W-ID</th>
                        <th>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö (‡∏ä‡∏∑‡πà‡∏≠)</th>
                        <th>‡∏™‡∏≤‡∏¢ (‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á)</th>
                        <th>‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà (HL)</th>
                        <th>‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö (BH)</th>
                        <th>‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (BL)</th>
                    </tr>
                </thead>
                <tbody id="master-order-input-body">
                    <tr>
                        <td>W041-001</td>
                        <td><input type="text" id="master_name_001" value="‡∏ô‡∏≤‡∏¢‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡∏ß‡∏µ ‡∏ä‡∏π‡∏£‡∏∞‡∏™‡∏∏‡∏Ç"></td>
                        <td><input type="text" id="master_route_001" value="‡∏î‡∏≠‡∏ô‡∏â‡πà‡∏≥‡∏Ñ‡πâ‡∏≤"></td>
                        <td><input type="number" id="master_hl_001" value="65"></td>
                        <td><input type="number" id="master_bh_001" value="41"></td>
                        <td><input type="number" id="master_bl_001" value="2"></td>
                    </tr>
                    <tr>
                        <td>W041-002</td>
                        <td><input type="text" id="master_name_002" value="‡∏ô‡∏≤‡∏¢‡∏ß‡∏£‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏û‡∏£‡∏´‡∏°‡∏ä‡∏≤‡∏ï‡∏¥"></td>
                        <td><input type="text" id="master_route_002" value="‡πÇ‡∏û‡∏ô‡∏á‡∏≤‡∏°"></td>
                        <td><input type="number" id="master_hl_002" value="65"></td>
                        <td><input type="number" id="master_bh_002" value="30"></td>
                        <td><input type="number" id="master_bl_002" value="13"></td>
                    </tr>
                    <tr>
                        <td>W041-003</td>
                        <td><input type="text" id="master_name_003" value="‡∏ô‡∏≤‡∏¢‡πÇ‡∏û‡∏ò‡∏¥‡πå ‡∏õ‡πâ‡∏≠‡∏á‡∏à‡∏ß‡∏á‡∏•‡∏≤"></td>
                        <td><input type="text" id="master_route_003" value="‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏°‡πâ‡∏≠"></td>
                        <td><input type="number" id="master_hl_003" value="65"></td>
                        <td><input type="number" id="master_bh_003" value="35"></td>
                        <td><input type="number" id="master_bl_003" value="8"></td>
                    </tr>
                    <tr>
                        <td>W041-004</td>
                        <td><input type="text" id="master_name_004" value="‡∏ô‡∏≤‡∏¢‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏ä‡∏±‡∏¢ ‡πÇ‡∏™‡∏°‡∏≤‡∏ß‡∏±‡∏ï‡∏£"></td>
                        <td><input type="text" id="master_route_004" value="‡πÇ‡∏Ñ‡∏Å‡∏™‡∏ß‡πà‡∏≤‡∏á"></td>
                        <td><input type="number" id="master_hl_004" value="50"></td>
                        <td><input type="number" id="master_bh_004" value="50"></td>
                        <td><input type="number" id="master_bl_004" value="8"></td>
                    </tr>
                    <tr>
                        <td>W041-005</td>
                        <td><input type="text" id="master_name_005" value="‡∏ô‡∏≤‡∏¢‡∏ó‡∏£‡∏á‡∏¢‡∏® ‡∏¢‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô"></td>
                        <td><input type="text" id="master_route_005" value="‡∏´‡∏ô‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ö"></td>
                        <td><input type="number" id="master_hl_005" value="70"></td>
                        <td><input type="number" id="master_bh_005" value="23"></td>
                        <td><input type="number" id="master_bl_005" value="15"></td>
                    </tr>
                    <tr>
                        <td>W041-006</td>
                        <td><input type="text" id="master_name_006" value="‡∏ô‡∏≤‡∏¢‡∏≠‡πÑ‡∏ó‡∏û‡∏£ ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á"></td>
                        <td><input type="text" id="master_route_006" value="‡∏à‡∏≠‡∏°‡∏®‡∏£‡∏µ"></td>
                        <td><input type="number" id="master_hl_006" value="60"></td>
                        <td><input type="number" id="master_bh_006" value="43"></td>
                        <td><input type="number" id="master_bl_006" value="5"></td>
                    </tr>
                    <tr>
                        <td>W041-007</td>
                        <td><input type="text" id="master_name_007" value="‡∏ô‡∏≤‡∏¢‡∏ä‡∏±‡∏¢‡∏ì‡∏£‡∏á‡∏Ñ‡πå ‡∏û‡∏•‡∏ã‡∏∏‡πâ‡∏¢"></td>
                        <td><input type="text" id="master_route_007" value="‡∏î‡∏á‡∏≠‡πâ‡∏ô"></td>
                        <td><input type="number" id="master_hl_007" value="70"></td>
                        <td><input type="number" id="master_bh_007" value="32"></td>
                        <td><input type="number" id="master_bl_007" value="6"></td>
                    </tr>
                    <tr>
                        <td>W041-008</td>
                        <td><input type="text" id="master_name_008" value="‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏û‡∏á‡∏®‡πå ‡∏ß‡∏á‡∏©‡πå‡∏î‡∏µ"></td>
                        <td><input type="text" id="master_route_008" value="‡∏´‡∏°‡∏π‡πà‡∏°‡πà‡∏ô"></td>
                        <td><input type="number" id="master_hl_008" value="70"></td>
                        <td><input type="number" id="master_bh_008" value="28"></td>
                        <td><input type="number" id="master_bl_008" value="10"></td>
                    </tr>
                    <tr>
                        <td>W041-009</td>
                        <td><input type="text" id="master_name_009" value="‡∏ô‡∏≤‡∏¢‡∏ò‡∏ô‡∏¢‡∏®‡∏ä‡∏≤ ‡πÅ‡∏Å‡πâ‡∏ß‡∏™‡∏≠‡∏ô‡∏î‡∏µ"></td>
                        <td><input type="text" id="master_route_009" value="‡∏î‡∏≠‡∏ô‡πÅ‡∏û‡∏á"></td>
                        <td><input type="number" id="master_hl_009" value="70"></td>
                        <td><input type="number" id="master_bh_009" value="20"></td>
                        <td><input type="number" id="master_bl_009" value="8"></td>
                    </tr>
                </tbody>
            </table>
            
            <button id="save-master-list-btn" class="save-btn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Master List (‡∏•‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)</button>
            <button id="go-to-fulfillment-btn" class="nav-btn">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á (‡∏´‡∏ô‡πâ‡∏≤ 2) ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="page-fulfillment" class="page">
        <div class="container">
            <h2>‡∏´‡∏ô‡πâ‡∏≤ 2: üöö ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á (Fulfillment)</h2>
            <button id="go-to-master-btn" class="nav-btn">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ Master List (‡∏´‡∏ô‡πâ‡∏≤ 1)</button>
            
            <div class="control-panel">
                <div class="control-group">
                    <label for="date_select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà üóìÔ∏è</label>
                    <input type="date" id="date_select">
                </div>
                <div class="control-group">
                    <label for="truck_select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ üöö</label>
                    <select id="truck_select">
                        <option value="‡∏£‡∏ñ 1">‡∏£‡∏ñ 1 (W041-001)</option>
                        <option value="‡∏£‡∏ñ 2">‡∏£‡∏ñ 2 (W041-002)</option>
                        <option value="‡∏£‡∏ñ 3">‡∏£‡∏ñ 3 (W041-003)</option>
                        <option value="‡∏£‡∏ñ 4">‡∏£‡∏ñ 4 (W041-004)</option>
                        <option value="‡∏£‡∏ñ 5">‡∏£‡∏ñ 5 (W041-005)</option>
                        <option value="‡∏£‡∏ñ 6">‡∏£‡∏ñ 6 (W041-006)</option>
                        <option value="‡∏£‡∏ñ 7">‡∏£‡∏ñ 7 (W041-007)</option>
                        <option value="‡∏£‡∏ñ 8">‡∏£‡∏ñ 8 (W041-008)</option>
                        <option value="‡∏£‡∏ñ 9">‡∏£‡∏ñ 9 (W041-009)</option>
                    </select>
                </div>
            </div>

            <div id="master-order-summary">
                <h3>üìã ‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ö‡∏¥‡∏Å (Master Order)</h3>
                <div id="order-driver-name" style="font-size: 1.1em; font-weight: bold;">‡∏ä‡∏∑‡πà‡∏≠: -</div>
                <div id="order-route-name" style="margin-bottom: 10px;">‡∏™‡∏≤‡∏¢: -</div>
                
                <table style="font-size: 1.0em;">
                    <thead>
                        <tr style="background: #fdd835;">
                            <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                            <th>‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á (Master)</th>
                            <th>‡πÄ‡∏ö‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß (‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Ç‡∏≤)</th>
                            <th style="color: #c62828;">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà (HL)</td>
                            <td id="master_hl">0</td>
                            <td id="requisition_hl">0</td>
                            <td id="remaining_hl" class="remaining-qty">0</td>
                        </tr>
                        <tr>
                            <td>‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö (BH)</td>
                            <td id="master_bh">0</td>
                            <td id="requisition_bh">0</td>
                            <td id="remaining_bh" class="remaining-qty">0</td>
                        </tr>
                        <tr>
                            <td>‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (BL)</td>
                            <td id="master_bl">0</td>
                            <td id="requisition_bl">0</td>
                            <td id="remaining_bl" class="remaining-qty">0</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡∏£‡∏¥‡∏á (‡∏ï‡∏≤‡∏°‡∏Ç‡∏≤)</h3>
            <table id="fulfillment-table">
                <thead>
                    <tr>
                        <th rowspan="2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á</th>
                        <th colspan="2">‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å 1 (‡∏Ç‡∏≤ 1)</th>
                        <th colspan="2">‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å 2 (‡∏Ç‡∏≤ 2)</th>
                        <th colspan="2">‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å 3 (‡∏Ç‡∏≤ 3)</th>
                        </tr>
                    <tr>
                        <th>‡∏ü‡πâ‡∏≤ (‡∏ï‡∏π‡πâ)</th>
                        <th>‡πÅ‡∏î‡∏á (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</th>
                        <th>‡∏ü‡πâ‡∏≤ (‡∏ï‡∏π‡πâ)</th>
                        <th>‡πÅ‡∏î‡∏á (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</th>
                        <th>‡∏ü‡πâ‡∏≤ (‡∏ï‡∏π‡πâ)</th>
                        <th>‡πÅ‡∏î‡∏á (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà</td>
                        <td><input type="number" id="stk_1_hl_blue" class="input-blue" value="0"></td>
                        <td><input type="number" id="stk_1_hl_red" class="input-red" value="0"></td>
                        <td><input type="number" id="stk_2_hl_blue" class="input-blue" value="0"></td>
                        <td><input type="number" id="stk_2_hl_red" class="input-red" value="0"></td>
                        <td><input type="number" id="stk_3_hl_blue" class="input-blue" value="0"></td>
                        <td><input type="number" id="stk_3_hl_red" class="input-red" value="0"></td>
                    </tr>
                    <tr>
                        <td>‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö</td>
                        <td><input type="number" id="stk_1_bh_blue" class="input-blue" value="0"></td>
                        <td><input type="number" id="stk_1_bh_red" class="input-red" value="0"></td>
                        <td><input type="number" id="stk_2_bh_blue" class="input-blue" value="0"></td>
                        <td><input type="number" id="stk_2_bh_red" class="input-red" value="0"></td>
                        <td><input type="number" id="stk_3_bh_blue" class="input-blue" value="0"></td>
                        <td><input type="number" id="stk_3_bh_red" class="input-red" value="0"></td>
                    </tr>
                    <tr>
                        <td>‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</td>
                        <td><input type="number" id="stk_1_bl_blue" class="input-blue" value="0"></td>
                        <td><input type="number" id="stk_1_bl_red" class="input-red" value="0"></td>
                        <td><input type="number" id="stk_2_bl_blue" class="input-blue" value="0"></td>
                        <td><input type="number" id="stk_2_bl_red" class="input-red" value="0"></td>
                        <td><input type="number" id="stk_3_bl_blue" class="input-blue" value="0"></td>
                        <td><input type="number" id="stk_3_bl_red" class="input-red" value="0"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td>‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å (‡∏ï‡πà‡∏≠‡∏Ç‡∏≤)</td>
                        <td colspan="2" id="total_leg_1">0</td>
                        <td colspan="2" id="total_leg_2">0</td>
                        <td colspan="2" id="total_leg_3">0</td>
                    </tr>
                </tfoot>
            </table>
            <p style="text-align: right; color: #c62828; margin-top: -5px;">‚ö†Ô∏è *‡∏ñ‡πâ‡∏≤‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á = ‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô 36 ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö!*</p>
        </div>
    </div>

<script>
    // üî• "‡∏™‡∏°‡∏≠‡∏á" ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ (JavaScript) üî•

    // --- ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ID (W-ID <-> ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏ñ) ---
    const TRUCK_MAP = {
        "‡∏£‡∏ñ 1": "W041-001",
        "‡∏£‡∏ñ 2": "W041-002",
        "‡∏£‡∏ñ 3": "W041-003",
        "‡∏£‡∏ñ 4": "W041-004",
        "‡∏£‡∏ñ 5": "W041-005",
        "‡∏£‡∏ñ 6": "W041-006",
        "‡∏£‡∏ñ 7": "W041-007",
        "‡∏£‡∏ñ 8": "W041-008",
        "‡∏£‡∏ñ 9": "W041-009"
    };
    const MASTER_TRUCK_IDS = Object.values(TRUCK_MAP); // ["W041-001", ...]
    const FULFILL_ICE_TYPES = ['hl', 'bh', 'bl'];
    const FULFILL_LEGS = ['1', '2', '3'];
    const FULFILL_SOURCES = ['blue', 'red'];

    // --- ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° ID Inputs ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠ Save/Load State ---
    const allMasterInputIds = [];
    MASTER_TRUCK_IDS.forEach(id => {
        const numId = id.split('-')[1]; // "001"
        allMasterInputIds.push(`master_name_${numId}`);
        allMasterInputIds.push(`master_route_${numId}`);
        allMasterInputIds.push(`master_hl_${numId}`);
        allMasterInputIds.push(`master_bh_${numId}`);
        allMasterInputIds.push(`master_bl_${numId}`);
    });
    
    const allFulfillInputIds = [];
    FULFILL_LEGS.forEach(leg => {
        FULFILL_ICE_TYPES.forEach(type => {
            FULFILL_SOURCES.forEach(source => {
                allFulfillInputIds.push(`stk_${leg}_${type}_${source}`);
            });
        });
    });

    // --- Utility Functions (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏¢) ---
    function getEl(id) { return document.getElementById(id); }
    function getVal(id) { return getEl(id).value; }
    function setVal(id, value) { getEl(id).value = value; }
    function setHTML(id, html) { getEl(id).innerHTML = html; }
    function getNum(id) { return parseFloat(getVal(id)) || 0; }

    // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á (Navigation) ---
    document.addEventListener('DOMContentLoaded', () => {
        const pageMaster = getEl('page-master-order');
        const pageFulfill = getEl('page-fulfillment');

        // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        getEl('go-to-fulfillment-btn').onclick = () => {
            pageMaster.classList.remove('active');
            pageFulfill.classList.add('active');
            switchLog(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
        };
        getEl('go-to-master-btn').onclick = () => {
            pageFulfill.classList.remove('active');
            pageMaster.classList.add('active');
        };

        // --- Setup ‡∏´‡∏ô‡πâ‡∏≤ 1 (Master) ---
        getEl('save-master-list-btn').onclick = saveMasterList;
        loadMasterList(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Master ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ

        // --- Setup ‡∏´‡∏ô‡πâ‡∏≤ 2 (Fulfillment) ---
        const dateSelect = getEl('date_select');
        dateSelect.value = new Date().toISOString().split('T')[0]; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        
        // "‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå" ‡∏´‡∏•‡∏±‡∏Å: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏ñ
        dateSelect.onchange = switchLog;
        getEl('truck_select').onchange = switchLog;
        
        // "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì": ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å
        allFulfillInputIds.forEach(id => {
            getEl(id).oninput = calculate;
        });

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
        switchLog();
    });

    // --- "‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡∏´‡∏ô‡πâ‡∏≤ 1 (Master Order) ---
    function saveMasterList() {
        const masterDB = {};
        MASTER_TRUCK_IDS.forEach(id => {
            const numId = id.split('-')[1]; // "001"
            masterDB[id] = {
                name: getVal(`master_name_${numId}`),
                route: getVal(`master_route_${numId}`),
                hl: getNum(`master_hl_${numId}`),
                bh: getNum(`master_bh_${numId}`),
                bl: getNum(`master_bl_${numId}`)
            };
        });
        
        localStorage.setItem('MASTER_ORDERS_DB', JSON.stringify(masterDB));
        alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Master List ‡∏•‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß!');
    }

    function loadMasterList() {
        const db = localStorage.getItem('MASTER_ORDERS_DB');
        if (!db) return; // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
        
        const masterDB = JSON.parse(db);
        MASTER_TRUCK_IDS.forEach(id => {
            const order = masterDB[id];
            if (order) {
                const numId = id.split('-')[1];
                setVal(`master_name_${numId}`, order.name);
                setVal(`master_route_${numId}`, order.route);
                setVal(`master_hl_${numId}`, order.hl);
                setVal(`master_bh_${numId}`, order.bh);
                setVal(`master_bl_${numId}`, order.bl);
            }
        });
    }

    // --- "‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡∏´‡∏ô‡πâ‡∏≤ 2 (Fulfillment) ---
    function generateLogKey() {
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Key "‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß" (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà + ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ)
        const date = getVal('date_select');
        const truckName = getVal('truck_select');
        const truckId = TRUCK_MAP[truckName] || "UNKNOWN";
        return `fulfill_${date}_${truckId}`;
    }

    function saveFulfillmentState() {
        const logKey = generateLogKey();
        const state = {};
        allFulfillInputIds.forEach(id => {
            state[id] = getVal(id);
        });
        localStorage.setItem(logKey, JSON.stringify(state));
    }

    function loadFulfillmentState(logKey) {
        // 1. ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô 0
        allFulfillInputIds.forEach(id => setVal(id, '0'));
        
        // 2. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
        const stateJSON = localStorage.getItem(logKey);
        if (stateJSON) {
            const state = JSON.parse(stateJSON);
            allFulfillInputIds.forEach(id => {
                if (state[id] !== undefined) {
                    setVal(id, state[id]);
                }
            });
        }
    }

    // --- "‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå" ‡∏´‡∏•‡∏±‡∏Å (Fulfillment) ---
    function switchLog() {
        const logKey = generateLogKey();
        
        // 1. ‡πÇ‡∏´‡∏•‡∏î Master Order (‡∏à‡∏≤‡∏Å "‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡∏´‡∏ô‡πâ‡∏≤ 1)
        const masterDB = JSON.parse(localStorage.getItem('MASTER_ORDERS_DB') || '{}');
        const selectedTruckName = getVal('truck_select');
        const truckId = TRUCK_MAP[selectedTruckName];
        const order = masterDB[truckId];
        
        if (order) {
            setHTML('order-driver-name', `‡∏ä‡∏∑‡πà‡∏≠: ${order.name}`);
            setHTML('order-route-name', `‡∏™‡∏≤‡∏¢: ${order.route}`);
            setHTML('master_hl', order.hl);
            setHTML('master_bh', order.bh);
            setHTML('master_bl', order.bl);
        } else {
            setHTML('order-driver-name', `‡∏ä‡∏∑‡πà‡∏≠: - ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô Master List -`);
            setHTML('order-route-name', `‡∏™‡∏≤‡∏¢: -`);
            setHTML('master_hl', 0);
            setHTML('master_bh', 0);
            setHTML('master_bl', 0);
        }

        // 2. ‡πÇ‡∏´‡∏•‡∏î Fulfillment State (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ)
        loadFulfillmentState(logKey);
        
        // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
        calculate();
    }

    // --- "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì" (Fulfillment) ---
    function calculate() {
        // --- 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° "‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô" (‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏¢‡∏≠‡∏î Master Order) ---
        FULFILL_ICE_TYPES.forEach(type => { // 'hl', 'bh', 'bl'
            let totalRequisition = 0;
            FULFILL_LEGS.forEach(leg => { // '1', '2', '3'
                FULFILL_SOURCES.forEach(source => { // 'blue', 'red'
                    totalRequisition += getNum(`stk_${leg}_${type}_${source}`);
                });
            });
            
            const masterQty = parseFloat(getHTML(`master_${type}`)) || 0;
            const remainingQty = masterQty - totalRequisition;
            
            setHTML(`requisition_${type}`, totalRequisition);
            setHTML(`remaining_${type}`, remainingQty);
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡∏£‡∏ö
            const remainingEl = getEl(`remaining_${type}`);
            remainingEl.classList.toggle('complete', remainingQty <= 0);
        });

        // --- 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° "‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á" (‡πÄ‡∏ä‡πá‡∏Ñ 36 ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡∏Ç‡∏≤) ---
        const SACK_LIMIT = 36;
        FULFILL_LEGS.forEach(leg => { // '1', '2', '3'
            let totalLegQty = 0;
            FULFILL_ICE_TYPES.forEach(type => { // 'hl', 'bh', 'bl'
                FULFILL_SOURCES.forEach(source => { // 'blue', 'red'
                    totalLegQty += getNum(`stk_${leg}_${type}_${source}`);
                });
            });
            
            const totalEl = getEl(`total_leg_${leg}`);
            setHTML(`total_leg_${leg}`, totalLegQty);
            
            // üî• ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 36 üî•
            totalEl.classList.toggle('leg-total-warn', totalLegQty > SACK_LIMIT);
        });
        
        // --- 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏á `localStorage` ---
        saveFulfillmentState();
    }
</script>
</body>
</html>
