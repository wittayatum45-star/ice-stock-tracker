<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó W041-001 (Final UX/State)</title>
    <style>
        /* --- CSS Global --- */
        body { font-family: Tahoma, sans-serif; margin: 0; padding: 10px; background: #f0f2f5; font-size: 13px; color: #333; }
        .form-container { 
            width: 98%; 
            max-width: 850px; 
            margin: 10px auto; 
            padding: 15px 10px; 
            background: white; 
            border: 2px solid #333; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            overflow-x: auto; 
        }
        
        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (Ice Stock Table) */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 10px; 
            min-width: 600px; 
            font-size: 0.7em; 
            table-layout: auto;
        }
        th, td { 
            border: 1px solid #000; 
            padding: 1px 0px; 
            text-align: center; 
            vertical-align: top; 
            font-size: 1em; 
            line-height: 1.1; 
        }
        th { background: #dcdcdc; color: #333; font-weight: bold; height: 30px;}
        td.label { text-align: left; font-weight: bold; font-size: 1.1em; padding-left: 2px; }

        input[type="number"], input[type="text"] { 
            width: 100%; 
            padding: 1px 0; 
            text-align: right; 
            border: none; 
            box-sizing: border-box; 
            font-size: 0.8em; 
            background: none; 
        } 
        /* üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ Input ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô: ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏≠‡∏°‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô */
        input[type="number"].data-input-field { background: #fdfde7; }
        
        /* üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ Calculated Field ‡πÉ‡∏´‡πâ‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */
        .calculated-field { background: #e0f2f7; font-weight: bold; text-align: right; font-size: 0.9em;}
        /* üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ Money Field */
        .money-field { background: #e8f5e9; font-weight: bold; text-align: right; font-size: 0.9em;}
        
        .sub-total-row td { background: #c8e6c9; font-weight: bold; padding: 3px 1px; }
        .grand-total-row td { background: #a5d6a7; font-weight: bold; font-size: 1em; white-space: nowrap; }

        /* ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á */
        .variance-row { background: #ffccbc; } /* ‡∏™‡πâ‡∏°‡∏≠‡πà‡∏≠‡∏ô */
        .variance-field { color: #d32f2f; font-weight: 900; } /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
        
        /* Summary Grid */
        .summary-box .money-field-output { border: 1px solid #000; padding: 2px; font-weight: bold; background: #e8f5e9; }
        .summary-row-item .data-input-box input { background: #fdfde7; }

        /* Media Query (‡πÉ‡∏ä‡πâ‡πÄ‡∏î‡∏¥‡∏°) */
        @media (max-width: 768px) {
            .summary-grid { flex-direction: column; }
            .form-container { padding: 5px; overflow-x: hidden; } 
            table thead tr:nth-child(1) th:nth-child(1) { width: 14%; } 
            table thead tr:nth-child(1) th:nth-child(2) { width: 28%; } 
            table td:nth-child(13), table td:nth-child(14), table td:nth-child(15) { 
                 text-align: right; 
                 padding-right: 2px;
            }
        }
    </style>
</head>
<body>

<div class="form-container">
    
    <table>
        <thead>
            <tr>
                <th rowspan="3" style="width: 15%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£<br/>‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á</th>
                <th colspan="6">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th rowspan="3" style="width: 5%;">‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡∏Å</th>
                <th rowspan="3" style="width: 5%;">‡∏Ñ‡∏∑‡∏ô<br/>‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th>
                <th rowspan="3" style="width: 5%;">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                <th rowspan="3" style="width: 5%;">‡πÅ‡∏ñ‡∏°/<br/>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</th>
                <th rowspan="3" style="width: 5%; color: red;">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢<br/>(‡∏™‡∏∏‡∏ó‡∏ò‡∏¥)</th>
                <th colspan="3" style="width: 30%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ</th>
            </tr>
            <tr>
                <th style="width: 4%;">1</th>
                <th style="width: 4%;">2</th>
                <th style="width: 4%;">3</th>
                <th style="width: 4%;">4</th>
                <th style="width: 4%;">5</th>
                <th style="width: 4%;">6</th>
                <th style="width: 5%;">‡∏£‡∏≤‡∏Ñ‡∏≤/<br/>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                <th style="width: 5%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                <th style="width: 10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <td colspan="3"></td>
            </tr>
        </thead>
        <tbody>
            
            <tr>
                <td class="label" rowspan="7">‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà</td>
                <td class="data-input"><input type="number" id="stk_1_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_2_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_3_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_4_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_5_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_6_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="total_in_hl">0</td>
                <td class="data-input"><input type="number" id="returned_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="net_remaining_hl">0</td>
                <td class="data-input"><input type="number" id="free_qty_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="sold_qty_hl">0</td>
                
                <td>**27**</td><td class="data-input"><input type="number" id="qty_27_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_27_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**28**</td><td class="data-input"><input type="number" id="qty_28_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_28_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>30</td><td class="data-input"><input type="number" id="qty_30_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_30_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>35</td><td class="data-input"><input type="number" id="qty_35_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_35_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**3/100**</td><td class="data-input"><input type="number" id="qty_33_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_33_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>40</td><td class="data-input"><input type="number" id="qty_40_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_40_hl">0.00</td>
            </tr>
             <tr class="variance-row"> 
                <td colspan="12" class="label" style="text-align: right; padding-right: 5px; font-weight: bold;">‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á)</td>
                <td class="calculated-field variance-field" id="sales_variance_hl">0</td>
                <td colspan="1"></td>
            </tr>


             <tr>
                <td class="label" rowspan="7">‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö</td>
                <td class="data-input"><input type="number" id="stk_1_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_2_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_3_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_4_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_5_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_6_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="total_in_bh">0</td>
                <td class="data-input"><input type="number" id="returned_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="net_remaining_bh">0</td>
                <td class="data-input"><input type="number" id="free_qty_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="sold_qty_bh">0</td>
                
                <td>**27**</td><td class="data-input"><input type="number" id="qty_27_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_27_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**28**</td><td class="data-input"><input type="number" id="qty_28_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_28_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>30</td><td class="data-input"><input type="number" id="qty_30_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_30_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>35</td><td class="data-input"><input type="number" id="qty_35_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_35_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**3/100**</td><td class="data-input"><input type="number" id="qty_33_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_33_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>40</td><td class="data-input"><input type="number" id="qty_40_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_40_bh">0.00</td>
            </tr>
             <tr class="variance-row"> 
                <td colspan="12" class="label" style="text-align: right; padding-right: 5px; font-weight: bold;">‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á)</td>
                <td class="calculated-field variance-field" id="sales_variance_bh">0</td>
                <td colspan="1"></td>
            </tr>


            <tr>
                <td class="label" rowspan="7">‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</td>
                <td class="data-input"><input type="number" id="stk_1_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_2_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_3_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_4_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_5_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_6_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="total_in_bl">0</td>
                <td class="data-input"><input type="number" id="returned_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="net_remaining_bl">0</td>
                <td class="data-input"><input type="number" id="free_qty_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="sold_qty_bl">0</td>
                
                <td>**27**</td><td class="data-input"><input type="number" id="qty_27_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_27_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**28**</td><td class="data-input"><input type="number" id="qty_28_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_28_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>30</td><td class="data-input"><input type="number" id="qty_30_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_30_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>35</td><td class="data-input"><input type="number" id="qty_35_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_35_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**3/100**</td><td class="data-input"><input type="number" id="qty_33_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_33_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>40</td><td class="data-input"><input type="number" id="qty_40_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_40_bl">0.00</td>
            </tr>
             <tr class="variance-row"> 
                <td colspan="12" class="label" style="text-align: right; padding-right: 5px; font-weight: bold;">‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á)</td>
                <td class="calculated-field variance-field" id="sales_variance_bl">0</td>
                <td colspan="1"></td>
            </tr>


            <tr class="sub-total-row">
                <td colspan="1" class="label">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</td>
                <td class="calculated-field" id="total_stk_1">0</td>
                <td class="calculated-field" id="total_stk_2">0</td>
                <td class="calculated-field" id="total_stk_3">0</td>
                <td class="calculated-field" id="total_stk_4">0</td>
                <td class="calculated-field" id="total_stk_5">0</td>
                <td class="calculated-field" id="total_stk_6">0</td>
                <td class="calculated-field" id="grand_total_in">0</td>
                <td class="calculated-field" id="total_returned">0</td>
                <td class="calculated-field" id="grand_net_remaining">0</td>
                <td class="calculated-field" id="total_free">0</td>
                <td class="calculated-field" id="grand_sold_qty">0</td>
                <td colspan="2" class="label" style="text-align: right; padding-right: 5px;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≤‡∏¢</td>
                <td class="money-field" id="grand_total_sales_final">0.00</td> 
            </tr>
        </tbody>
    </table>
    
    <div class="summary-grid">
        <div class="summary-box summary-left">
            <h4 style="margin: 0 0 5px 0; border-bottom: 1px dotted #ccc;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏•‡∏ö</h4>
            <div class="summary-row-item">
                <label>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡∏° (Total Sales)</label>
                <div class="money-field-output" id="summary_grand_total_sales">0.00</div>
            </div>
             <div class="summary-row-item discount-row">
                <label style="color: red;">‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î **4%**</label>
                <div class="money-field-output" id="discount_amount" style="color: red;">0.00</div>
            </div>
             <div class="summary-row-item">
                <label style="font-size: 1.1em;">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</label>
                <div class="money-field-output" id="net_sales_after_discount" style="background: #e0f7fa; font-size: 1.1em;">0.00</div>
            </div>
            <div class="summary-row-item">
                <label>‡∏´‡∏±‡∏Å ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</label>
                <div class="data-input-box"><input type="number" id="debt_in" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></div>
            </div>
            <div class="summary-row-item">
                <label>‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö</label>
                <div class="data-input-box"><input type="number" id="debt_out_cash" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></div>
            </div>
            <div class="summary-row-item">
                <label>‡∏¢‡∏≠‡∏î‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πâ‡∏≤‡∏á (+)</label>
                <div class="data-input-box"><input type="number" id="debt_pay_out" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></div>
            </div>
            <div class="summary-row-item">
                <label style="font-size: 1.1em;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô</label>
                <div class="money-field-output" id="total_after_debt" style="font-size: 1.1em; background: #ffe6f2;">0.00</div>
            </div>
            <div class="summary-row-item">
                <label>‡∏´‡∏±‡∏Å ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô (‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ)</label>
                <div class="data-input-box"><input type="number" id="transfer_money" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></div>
            </div>
            <div class="summary-row-item">
                <label style="font-size: 1.1em;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Net Cash Due)</label>
                <div class="money-field-output" id="net_cash_due" style="background: #b8daff; font-size: 1.1em;">0.00</div>
            </div>
        </div>
        
        <div class="summary-box summary-right">
            <h4 style="margin: 0 0 5px 0; border-bottom: 1px dotted #ccc;">
                <span style="font-size: 1.5em; color: #ffc107;">üíµ</span> ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ
            </h4>
            
             <table class="cash-counter-compact">
                <thead>
                    <tr>
                        <th style="width: 25%;">‡∏ä‡∏ô‡∏¥‡∏î<br/>(‡∏ö‡∏≤‡∏ó)</th> 
                        <th style="width: 45%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th> 
                        <th style="width: 30%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô<br/>(‡∏ö‡∏≤‡∏ó)</th> 
                    </tr>
                </thead>
                <tbody>
                    <tr id="cash_row_1000">
                        <td class="denomination-label">1,000</td>
                        <td>
                            <div class="qty-control">
                                <button onclick="adjustQty('cash_qty_1000', -1)" class="adjust-btn minus-btn">-</button>
                                <input type="number" min="0" value="0" id="cash_qty_1000" oninput="calculateCash()" onfocus="clearAndFocus(this)" inputmode="numeric">
                                <button onclick="adjustQty('cash_qty_1000', 1)" class="adjust-btn plus-btn">+</button>
                            </div>
                        </td>
                        <td class="cash-total-display" id="cash_total_1000">0.00</td>
                    </tr>
                    <tr id="cash_row_500">
                        <td class="denomination-label">500</td>
                        <td>
                            <div class="qty-control">
                                <button onclick="adjustQty('cash_qty_500', -1)" class="adjust-btn minus-btn">-</button>
                                <input type="number" min="0" value="0" id="cash_qty_500" oninput="calculateCash()" onfocus="clearAndFocus(this)" inputmode="numeric">
                                <button onclick="adjustQty('cash_qty_500', 1)" class="adjust-btn plus-btn">+</button>
                            </div>
                        </td>
                        <td class="cash-total-display" id="cash_total_500">0.00</td>
                    </tr>
                    <tr id="cash_row_100">
                        <td class="denomination-label">100</td>
                        <td>
                            <div class="qty-control">
                                <button onclick="adjustQty('cash_qty_100', -1)" class="adjust-btn minus-btn">-</button>
                                <input type="number" min="0" value="0" id="cash_qty_100" oninput="calculateCash()" onfocus="clearAndFocus(this)" inputmode="numeric">
                                <button onclick="adjustQty('cash_qty_100', 1)" class="adjust-btn plus-btn">+</button>
                            </div>
                        </td>
                        <td class="cash-total-display" id="cash_total_100">0.00</td>
                    </tr>
                    <tr id="cash_row_50">
                        <td class="denomination-label">50</td>
                        <td>
                            <div class="qty-control">
                                <button onclick="adjustQty('cash_qty_50', -1)" class="adjust-btn minus-btn">-</button>
                                <input type="number" min="0" value="0" id="cash_qty_50" oninput="calculateCash()" onfocus="clearAndFocus(this)" inputmode="numeric">
                                <button onclick="adjustQty('cash_qty_50', 1)" class="adjust-btn plus-btn">+</button>
                            </div>
                        </td>
                        <td class="cash-total-display" id="cash_total_50">0.00</td>
                    </tr>
                    <tr id="cash_row_20">
                        <td class="denomination-label">20</td>
                        <td>
                            <div class="qty-control">
                                <button onclick="adjustQty('cash_qty_20', -1)" class="adjust-btn minus-btn">-</button>
                                <input type="number" min="0" value="0" id="cash_qty_20" oninput="calculateCash()" onfocus="clearAndFocus(this)" inputmode="numeric">
                                <button onclick="adjustQty('cash_qty_20', 1)" class="adjust-btn plus-btn">+</button>
                            </div>
                        </td>
                        <td class="cash-total-display" id="cash_total_20">0.00</td>
                    </tr>
                    <tr id="cash_row_10">
                        <td class="denomination-label">10</td>
                        <td>
                            <div class="qty-control">
                                <button onclick="adjustQty('cash_qty_10', -1)" class="adjust-btn minus-btn">-</button>
                                <input type="number" min="0" value="0" id="cash_qty_10" oninput="calculateCash()" onfocus="clearAndFocus(this)" inputmode="numeric">
                                <button onclick="adjustQty('cash_qty_10', 1)" class="adjust-btn plus-btn">+</button>
                            </div>
                        </td>
                        <td class="cash-total-display" id="cash_total_10">0.00</td>
                    </tr>
                    <tr id="cash_row_5">
                        <td class="denomination-label">5</td>
                        <td>
                            <div class="qty-control">
                                <button onclick="adjustQty('cash_qty_5', -1)" class="adjust-btn minus-btn">-</button>
                                <input type="number" min="0" value="0" id="cash_qty_5" oninput="calculateCash()" onfocus="clearAndFocus(this)" inputmode="numeric">
                                <button onclick="adjustQty('cash_qty_5', 1)" class="adjust-btn plus-btn">+</button>
                            </div>
                        </td>
                        <td class="cash-total-display" id="cash_total_5">0.00</td>
                    </tr>
                    <tr id="cash_row_2">
                        <td class="denomination-label">2</td>
                        <td>
                            <div class="qty-control">
                                <button onclick="adjustQty('cash_qty_2', -1)" class="adjust-btn minus-btn">-</button>
                                <input type="number" min="0" value="0" id="cash_qty_2" oninput="calculateCash()" onfocus="clearAndFocus(this)" inputmode="numeric">
                                <button onclick="adjustQty('cash_qty_2', 1)" class="adjust-btn plus-btn">+</button>
                            </div>
                        </td>
                        <td class="cash-total-display" id="cash_total_2">0.00</td>
                    </tr>
                    <tr id="cash_row_1">
                        <td class="denomination-label">1</td>
                        <td>
                            <div class="qty-control">
                                <button onclick="adjustQty('cash_qty_1', -1)" class="adjust-btn minus-btn">-</button>
                                <input type="number" min="0" value="0" id="cash_qty_1" oninput="calculateCash()" onfocus="clearAndFocus(this)" inputmode="numeric">
                                <button onclick="adjustQty('cash_qty_1', 1)" class="adjust-btn plus-btn">+</button>
                            </div>
                        </td>
                        <td class="cash-total-display" id="cash_total_1">0.00</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr class="grand-total-cash-row">
                        <td colspan="2">‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ</td>
                        <td id="cash_grand_total">0.00</td>
                    </tr>
                </tfoot>
            </table>
            
            <span id="actual_cash_counted" style="display: none;">0</span>

            <div class="cash-summary-footer">
                <div class="summary-row">
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏£‡∏ñ</label>
                    <select id="truck_select" onchange="switchTruck(this.value)" style="width: 50%; text-align: right; height: 25px; padding: 2px; font-size: 0.9em; box-sizing: border-box;">
                        <option value="‡∏£‡∏ñ 1">‡∏£‡∏ñ 1</option>
                        <option value="‡∏£‡∏ñ 2">‡∏£‡∏ñ 2</option>
                        <option value="‡∏£‡∏ñ 3">‡∏£‡∏ñ 3</option>
                        <option value="‡∏£‡∏ñ 4">‡∏£‡∏ñ 4</option>
                        <option value="‡∏£‡∏ñ 5">‡∏£‡∏ñ 5</option>
                        <option value="‡∏£‡∏ñ 6">‡∏£‡∏ñ 6</option>
                        <option value="‡∏£‡∏ñ 7">‡∏£‡∏ñ 7</option>
                        <option value="‡∏£‡∏ñ 8">‡∏£‡∏ñ 8</option>
                        <option value="‡∏£‡∏ñ 9">‡∏£‡∏ñ 9</option>
                    </select>
                </div>
                
                <div class="summary-row">
                    <label>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á (‡∏ï‡∏≤‡∏°‡∏ö‡∏¥‡∏•/‡∏£‡∏∞‡∏ö‡∏ö)</label>
                    <input type="number" id="system_sales_amount" value="0" oninput="calculateDifference(parseFloat(document.getElementById('actual_cash_counted').textContent) || 0); saveState()" onfocus="clearAndFocus(this)" class="data-input-field sales-input" inputmode="numeric">
                </div>
                
                <div class="summary-row">
                    <label>‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ - ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢)</label>
                    <input type="text" id="difference_amount" value="0.00" readonly style="background: #ffe0e0; font-weight: bold; padding: 2px 5px; border: 1px solid #ccc; width: 50%; height: 25px; text-align: right; box-sizing: border-box;">
                </div>
                
                 <button onclick="saveAndExport()">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
                </button>
            </div>
        </div>
    </div>
</div>


<script>
    const iceTypes = ['hl', 'bh', 'bl'];
    const pricesHL = [27, 28, 30, 35, 33.33333333333333, 40]; 
    const pricesBH = [27, 28, 30, 35, 33.33333333333333, 40]; 
    const pricesBL = [27, 28, 30, 35, 33.33333333333333, 40];
    const cashDenominations = [1000, 500, 100, 50, 20, 10, 5, 2, 1];
    const allInputIds = []; // ‡πÄ‡∏Å‡πá‡∏ö ID ‡∏Ç‡∏≠‡∏á Input ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Save/Load

    // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° ID ‡∏Ç‡∏≠‡∏á input fields ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('input[type="number"], input[type="text"], select').forEach(el => {
            if (el.id && el.id !== 'difference_amount') {
                allInputIds.push(el.id);
            }
        });
    });

    // ################ State Management (Save/Load) ################
    function saveState() {
        const truckId = document.getElementById('truck_select').value;
        const state = {};
        
        allInputIds.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                state[id] = el.value;
            }
        });
        
        localStorage.setItem(`truckState_${truckId}`, JSON.stringify(state));
    }

    function loadState(truckId) {
        const stateJSON = localStorage.getItem(`truckState_${truckId}`);
        if (stateJSON) {
            const state = JSON.parse(stateJSON);
            allInputIds.forEach(id => {
                const el = document.getElementById(id);
                if (el && state[id] !== undefined) {
                    el.value = state[id];
                }
            });
        } else {
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (0)
            allInputIds.forEach(id => {
                const el = document.getElementById(id);
                if (el && el.tagName !== 'SELECT') {
                    el.value = '0';
                }
            });
        }
        
        // ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏™‡∏°‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î/‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
        calculateCash();
        calculate();
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏£‡∏ñ
    function switchTruck(newTruckId) {
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô
        const currentTruckId = localStorage.getItem('currentTruckId') || '‡∏£‡∏ñ 1';
        if (currentTruckId !== newTruckId) {
            saveState();
        }
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà
        localStorage.setItem('currentTruckId', newTruckId);
        loadState(newTruckId);
    }

    // ################ Utility Functions ################
    function formatCurrency(amount) {
        return parseFloat(amount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    function getInputValue(id) {
        const inputElement = document.getElementById(id);
        if (!inputElement || inputElement.value.trim() === '-' || inputElement.value.trim() === '') {
            return 0;
        }
        return Math.round(parseFloat(inputElement.value) * 100) / 100 || 0;
    }
    
    function clearAndFocus(inputElement) {
        inputElement.setAttribute('inputmode', 'decimal'); 
        if (inputElement.value === '0') {
            inputElement.value = ''; 
        }
    }
    
    document.addEventListener('blur', (event) => {
        if (event.target.classList.contains('data-input-field') && event.target.value === '') {
            event.target.value = '0';
            calculate();
            calculateCash();
        }
        saveState(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á input
    }, true); 
    
    function adjustQty(id, delta) {
        const inputElement = document.getElementById(id);
        let currentQty = parseInt(inputElement.value) || 0; 
        
        let newQty = currentQty + delta;
        
        if (newQty < 0) {
            newQty = 0;
        }
        inputElement.value = newQty;
        calculateCash();
        saveState();
    }

    function calculateCash() {
        let cashGrandTotal = 0;
        cashDenominations.forEach(value => {
            const qty = getInputValue(`cash_qty_${value}`);
            const rowTotal = qty * value;
            document.getElementById(`cash_total_${value}`).textContent = formatCurrency(rowTotal);
            cashGrandTotal += rowTotal;
        });
        
        cashGrandTotal = Math.round(cashGrandTotal * 100) / 100;
        
        document.getElementById('cash_grand_total').textContent = formatCurrency(cashGrandTotal);
        document.getElementById('actual_cash_counted').textContent = cashGrandTotal; 
        
        calculateDifference(cashGrandTotal);
        return cashGrandTotal;
    }

    function calculateDifference(actualCash) {
        const systemSales = getInputValue('system_sales_amount');
        const difference = actualCash - systemSales;
        
        const roundedDifference = Math.round(difference * 100) / 100;

        const diffElement = document.getElementById('difference_amount');
        diffElement.value = formatCurrency(roundedDifference); 
        
        diffElement.style.backgroundColor = (roundedDifference < 0) ? '#ffb3b3' : (roundedDifference > 0) ? '#c2f0c2' : '#f0f8ff';
    }
    
    function customRound(amount) {
        const decimalPart = amount % 1; 
        if (decimalPart >= 0.60 - 0.000001) { 
            return Math.ceil(amount); 
        } else {
            return Math.floor(amount); 
        }
    }


    /** ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å */
    function calculate() {
        let grandTotalSales = 0;
        let grandTotalIn = 0; 
        let grandReturned = 0; 
        let grandNetRemaining = 0; 
        let totalFree = 0;
        let grandSoldQty = 0; 

        let totalStk1 = 0;
        let totalStk2 = 0;
        let totalStk3 = 0;
        let totalStk4 = 0;
        let totalStk5 = 0;
        let totalStk6 = 0;


        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ ---
        iceTypes.forEach(type => {
            let totalIn = 0;
            for (let i = 1; i <= 6; i++) {
                const stkValue = getInputValue(`stk_${i}_${type}`);
                totalIn += stkValue;
                if (i === 1) totalStk1 += stkValue;
                else if (i === 2) totalStk2 += stkValue;
                else if (i === 3) totalStk3 += stkValue;
                else if (i === 4) totalStk4 += stkValue;
                else if (i === 5) totalStk5 += stkValue;
                else if (i === 6) totalStk6 += stkValue;
            }
            
            let returned = getInputValue(`returned_${type}`);
            let freeQty = getInputValue(`free_qty_${type}`);

            let netRemaining = totalIn - returned; 
            let soldQty = netRemaining - freeQty; 
            
            document.getElementById(`total_in_${type}`).textContent = Math.round(totalIn);
            document.getElementById(`net_remaining_${type}`).textContent = Math.round(netRemaining);
            document.getElementById(`sold_qty_${type}`).textContent = Math.round(soldQty); 

            grandTotalIn += totalIn;
            grandReturned += returned;
            grandNetRemaining += netRemaining; 
            totalFree += freeQty;
            grandSoldQty += soldQty; 

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≤‡∏¢
            let subTotalMoney = 0;
            let totalQtySoldRecorded = 0;
            let currentPrices = [];
            
            if (type === 'hl') currentPrices = pricesHL;
            else if (type === 'bh') currentPrices = pricesBH;
            else if (type === 'bl') currentPrices = pricesBL;

            currentPrices.forEach(priceValue => {
                let basePrice = (priceValue === 33.33333333333333) ? '33' : String(priceValue);
                const qty = getInputValue(`qty_${basePrice}_${type}`);
                totalQtySoldRecorded += qty;
                
                let money = qty * priceValue;
                money = Math.round(money * 100) / 100;
                
                const moneyElement = document.getElementById(`money_${basePrice}_${type}`);
                if (moneyElement) {
                    moneyElement.textContent = formatCurrency(money);
                    subTotalMoney += money;
                }
            });
            
            // üî• ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (Variance) üî•
            let salesVariance = soldQty - totalQtySoldRecorded; 
            salesVariance = Math.round(salesVariance * 100) / 100; 

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ä‡πà‡∏≠‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á
            const varianceElement = document.getElementById(`sales_variance_${type}`);
            varianceElement.textContent = salesVariance;
            varianceElement.style.color = (salesVariance === 0) ? '#1b5e20' : (salesVariance > 0) ? '#d32f2f' : '#0d47a1'; // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß=0, ‡πÅ‡∏î‡∏á=‡∏Ç‡∏≤‡∏î, ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô=‡πÄ‡∏Å‡∏¥‡∏ô
            
            subTotalMoney = Math.round(subTotalMoney * 100) / 100;
            grandTotalSales += subTotalMoney; 
        });

        grandTotalSales = Math.round(grandTotalSales * 100) / 100;

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (Grand Totals) ---
        // ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏≠‡∏á Stock 1-6
        document.getElementById('total_stk_1').textContent = Math.round(totalStk1);
        document.getElementById('total_stk_2').textContent = Math.round(totalStk2);
        document.getElementById('total_stk_3').textContent = Math.round(totalStk3);
        document.getElementById('total_stk_4').textContent = Math.round(totalStk4);
        document.getElementById('total_stk_5').textContent = Math.round(totalStk5);
        document.getElementById('total_stk_6').textContent = Math.round(totalStk6);

        // ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô
        document.getElementById('grand_total_in').textContent = Math.round(grandTotalIn);
        document.getElementById('total_returned').textContent = Math.round(grandReturned);
        document.getElementById('grand_net_remaining').textContent = Math.round(grandNetRemaining);
        document.getElementById('total_free').textContent = Math.round(totalFree);
        document.getElementById('grand_sold_qty').textContent = Math.round(grandSoldQty); 

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≤‡∏¢ 
        document.getElementById('grand_total_sales_final').textContent = formatCurrency(grandTotalSales); 
        document.getElementById('summary_grand_total_sales').textContent = formatCurrency(grandTotalSales);
        
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3/4: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ---
        const discountRate = 0.04;
        let discountAmount = customRound(grandTotalSales * discountRate); 
        let netSalesAfterDiscount = Math.round((grandTotalSales - discountAmount) * 100) / 100;
        
        const debtIn = getInputValue('debt_in'); 
        const debtOutCash = getInputValue('debt_out_cash'); 
        const debtPayOut = getInputValue('debt_pay_out'); 
        const transferMoney = getInputValue('transfer_money'); 
        
        let totalAfterDebt = Math.round((netSalesAfterDiscount - debtIn - debtOutCash + debtPayOut) * 100) / 100;
        let netCashDue = Math.round((totalAfterDebt - transferMoney) * 100) / 100;
        
        document.getElementById('discount_amount').textContent = formatCurrency(-discountAmount); 
        document.getElementById('net_sales_after_discount').textContent = formatCurrency(netSalesAfterDiscount); 
        document.getElementById('total_after_debt').textContent = formatCurrency(totalAfterDebt);
        document.getElementById('net_cash_due').textContent = formatCurrency(netCashDue);
        
        const actualCash = parseFloat(document.getElementById('actual_cash_counted').textContent) || 0;
        calculateDifference(actualCash);
        
        saveState(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡∏£‡πá‡∏à
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
    function saveAndExport() {
        // ... (‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Download) ...
        const truckId = document.getElementById('truck_select').value;
        const netCashDue = parseFloat(document.getElementById('net_cash_due').textContent.replace(/,/g, '')) || 0;
        const grandTotalSales = parseFloat(document.getElementById('summary_grand_total_sales').textContent.replace(/,/g, '')) || 0;
        const countedCash = parseFloat(document.getElementById('actual_cash_counted').textContent) || 0;
        const difference = countedCash - grandTotalSales;
        
        let reportData = `--- ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ${truckId} ---\n`;
        reportData += `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≤‡∏¢ (‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏±‡∏Å): ${formatCurrency(grandTotalSales)} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥‡∏™‡πà‡∏á): ${formatCurrency(netCashDue)} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á: ${formatCurrency(countedCash)} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ - ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢): ${formatCurrency(difference)} ‡∏ö‡∏≤‡∏ó\n\n`;
        
        reportData += "--- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á ---\n";
        iceTypes.forEach(type => {
            const soldQty = document.getElementById(`sold_qty_${type}`).textContent;
            const variance = document.getElementById(`sales_variance_${type}`).textContent;
            const label = (type === 'hl' ? '‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà' : type === 'bh' ? '‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö' : '‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î');
            reportData += `${label} | ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${soldQty} | ‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡∏Ç‡∏≤‡∏î/‡πÄ‡∏Å‡∏¥‡∏ô): ${variance}\n`;
        });

        const blob = new Blob([reportData], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Report_${truckId}_${new Date().toISOString().slice(0, 10)}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${truckId}!`);
    }

    // üî• Initial Load üî•
    document.addEventListener('DOMContentLoaded', () => {
         // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
         const storedTruckId = localStorage.getItem('currentTruckId') || '‡∏£‡∏ñ 1';
         const truckSelect = document.getElementById('truck_select');
         truckSelect.value = storedTruckId;
         
         // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° ID ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏ö
         document.querySelectorAll('input[type="number"], input[type="text"], select').forEach(el => {
            if (el.id && el.id !== 'difference_amount') {
                allInputIds.push(el.id);
            }
         });

         loadState(storedTruckId); 
    });
</script>
</body>
</html>
