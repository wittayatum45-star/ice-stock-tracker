<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ทะเบียนบท W041-001</title>
    <style>
        /* CSS หลัก */
        body { font-family: sans-serif; margin: 0; padding: 10px; background: #f0f2f5; font-size: 14px; color: #333; }
        
        .form-container {
            width: 98%; 
            max-width: 900px; /* ลดความกว้างสูงสุดเพื่อให้เหมาะกับมือถือ */
            margin: 10px auto;
            padding: 15px 10px;
            background: white;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow-x: auto; 
        }

        /* Main table styles */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 15px; 
            table-layout: auto; /* ** FIX: กลับไปใช้ Auto เพื่อความยืดหยุ่น ** */
            min-width: 600px; /* ลดความกว้างขั้นต่ำ */
        }
        th, td { 
            border: 1px solid #aaa; 
            padding: 3px 1px;
            text-align: center; 
            vertical-align: middle; 
            font-size: 0.75em; 
            line-height: 1.2;
        }
        th { background: #e0e0e0; font-weight: bold; }
        td.label { text-align: left; font-weight: bold; font-size: 0.85em; }

        /* ** FIX: จัดความกว้างคอลัมน์ใหม่ (น้อยลงแต่ยืดหยุ่น) ** */
        table thead th:nth-child(1) { width: 10%; } /* รายการ */
        table thead th:nth-child(2) { width: 10%; } /* ยอดเบิก (รวม) */
        table thead th:nth-child(3), th:nth-child(4), th:nth-child(5), th:nth-child(6) { width: 8%; } /* คืน/คงเหลือ/ขาย/แถม */
        table thead th:nth-child(7) { width: 6%; } /* ราคา/หน่วย */
        table thead th:nth-child(8) { width: 8%; } /* จำนวน */
        table thead th:nth-child(9) { width: 10%; } /* จำนวนเงิน */
        table thead th:nth-child(10) { width: 5%; } /* (%) */
        table thead th:nth-child(11) { width: 8%; } /* หมายเหตุ */

        /* Input specific styles */
        input[type="number"] { width: 100%; padding: 2px 0; text-align: right; border: none; box-sizing: border-box; font-size: 0.9em; background: none; }
        input[type="number"]:focus { outline: 1px solid #007bff; background: #e6f7ff; }

        /* Calculated fields (read-only) */
        .calculated-field { background: #f0f8ff; font-weight: bold; text-align: right; }
        .money-field { background: #e6ffe6; font-weight: bold; text-align: right; }
        .data-input input { background: #f9f9c5; } 
        .data-input { background: #f9f9c5; } 
        .sub-total-row td { background: #fffacd; font-weight: bold; }
        .grand-total-row td { background: #d4edda; font-weight: bold; font-size: 1em; }

        /* Summary sections */
        .detail-tables { display: flex; flex-wrap: wrap; justify-content: space-between; margin-top: 20px; }
        .detail-table-container { width: 49%; min-width: 300px; margin-bottom: 20px; }
        .cash-box label { display: block; font-weight: bold; margin-top: 10px; font-size: 0.8em; }
        .cash-box span, .cash-box input { display: block; width: 100%; padding: 5px; margin-top: 2px; margin-bottom: 5px; border: 1px solid #ccc; box-sizing: border-box; font-size: 0.9em; }
        .cash-box span { background-color: #f9f9f9; text-align: right; }
        .red-text { color: red; }
        .blue-text { color: #007bff; }
    </style>
</head>
<body>

<div class="form-container">
    
    <h1 style="text-align: left; margin-bottom: 10px; font-size: 1.5em; border-bottom: 2px solid #ccc; padding-bottom: 5px;">❄️ ระบบกระทบยอดขายและสต๊อกน้ำแข็ง</h1>
    
    <table>
        <thead>
            <tr>
                <th rowspan="2">รายการ</th>
                <th colspan="1">ยอดเบิก</th>
                <th rowspan="2">คืน</th>
                <th rowspan="2">เหลือ</th>
                <th rowspan="2">ขาย</th>
                <th rowspan="2">แถม</th>
                <th colspan="3">จำนวนเงินขายได้จริง</th>
                <th rowspan="2">หมายเหตุ</th>
            </tr>
            <tr>
                <th>รวม</th>
                <th>ราคา/หน่วย</th>
                <th>จำนวน</th>
                <th>จำนวนเงิน</th>
            </tr>
        </thead>
        <tbody>
            
            <tr>
                <td class="label" rowspan="7">หลอดใหญ่</td>
                <td class="data-input"><input type="number" id="total_in_hl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="returned_hl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td>
                <td class="calculated-field" id="net_remaining_hl">0</td>
                <td class="calculated-field" id="sold_qty_hl">0</td>
                <td class="data-input"><input type="number" id="free_qty_hl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td>
                <td>27</td><td class="data-input"><input type="number" id="price_27_hl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_27_hl">0.00</td><td rowspan="7"></td>
            </tr>
            <tr>
                <td colspan="5"></td><td>28</td><td class="data-input"><input type="number" id="price_28_hl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_28_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>30</td><td class="data-input"><input type="number" id="price_30_hl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_30_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>35</td><td class="data-input"><input type="number" id="price_35_hl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_35_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>100/3</td><td class="data-input"><input type="number" id="price_100_hl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_100_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>40</td><td class="data-input"><input type="number" id="price_40_hl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_40_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>-</td><td class="data-input"><input type="number" id="price_custom_hl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_custom_hl">0.00</td>
            </tr>
            <tr class="sub-total-row">
                <td colspan="8" class="label">รวมยอดเงิน หลอดใหญ่</td>
                <td class="money-field" id="sub_total_money_hl">0.00</td>
                <td></td>
            </tr>

            
            <tr>
                <td class="label" rowspan="7">บดหยาบ</td>
                <td class="data-input"><input type="number" id="total_in_bh" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="returned_bh" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td>
                <td class="calculated-field" id="net_remaining_bh">0</td>
                <td class="calculated-field" id="sold_qty_bh">0</td>
                <td class="data-input"><input type="number" id="free_qty_bh" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td>
                <td>27</td><td class="data-input"><input type="number" id="price_27_bh" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_27_bh">0.00</td><td rowspan="7"></td>
            </tr>
            <tr>
                <td colspan="5"></td><td>28</td><td class="data-input"><input type="number" id="price_28_bh" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_28_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>30</td><td class="data-input"><input type="number" id="price_30_bh" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_30_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>35</td><td class="data-input"><input type="number" id="price_35_bh" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_35_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>100/3</td><td class="data-input"><input type="number" id="price_100_bh" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_100_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>40</td><td class="data-input"><input type="number" id="price_40_bh" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_40_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>-</td><td class="data-input"><input type="number" id="price_custom_bh" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_custom_bh">0.00</td>
            </tr>
            <tr class="sub-total-row">
                <td colspan="8" class="label">รวมยอดเงิน บดหยาบ</td>
                <td class="money-field" id="sub_total_money_bh">0.00</td>
                <td></td>
            </tr>

            
            <tr>
                <td class="label" rowspan="7">บดละเอียด</td>
                <td class="data-input"><input type="number" id="total_in_bl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="returned_bl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td>
                <td class="calculated-field" id="net_remaining_bl">0</td>
                <td class="calculated-field" id="sold_qty_bl">0</td>
                <td class="data-input"><input type="number" id="free_qty_bl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td>
                <td>27</td><td class="data-input"><input type="number" id="price_27_bl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_27_bl">0.00</td><td rowspan="7"></td>
            </tr>
            <tr>
                <td colspan="5"></td><td>28</td><td class="data-input"><input type="number" id="price_28_bl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_28_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>30</td><td class="data-input"><input type="number" id="price_30_bl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_30_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>35</td><td class="data-input"><input type="number" id="price_35_bl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_35_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>100/3</td><td class="data-input"><input type="number" id="price_100_bl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_100_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>40</td><td class="data-input"><input type="number" id="price_40_bl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_40_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="5"></td><td>-</td><td class="data-input"><input type="number" id="price_custom_bl" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="money_custom_bl">0.00</td>
            </tr>
            <tr class="sub-total-row">
                <td colspan="8" class="label">รวมยอดเงิน บดละเอียด</td>
                <td class="money-field" id="sub_total_money_bl">0.00</td>
                <td></td>
            </tr>
            <tr class="grand-total-row">
                <td colspan="1">รวมเบิกทั้งหมด</td>
                <td class="calculated-field" id="grand_total_out">0</td>
                <td class="label">คืนทั้งสิ้น</td>
                <td class="calculated-field" id="total_returned">0</td>
                <td class="label">คงเหลือสุทธิ</td>
                <td class="calculated-field" id="grand_net_remaining">0</td>
                <td class="label">ยอดรวมขาย</td>
                <td class="money-field" id="grand_total_sales">0.00</td>
                <td></td>
            </tr>
        </tbody>
    </table>

    
    <div class="detail-tables">
        <div class="detail-table-container">
            <h3>รายการรายละเอียดการนำส่งเงิน</h3>
            <p style="font-size: 0.8em; margin-bottom: 5px;">*ยอดเงินสดที่นับได้จะคำนวณอัตโนมัติ</p>
            <table>
                <thead>
                    <tr>
                        <th>ชนิด</th>
                        <th>จำนวน</th>
                        <th>จำนวนเงิน (บาท)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-value="1000"><td>1,000</td><td class="data-input"><input type="number" id="cash_qty_1000" value="0" oninput="calculateCash()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="cash_total_1000">0.00</td></tr>
                    <tr data-value="500"><td>500</td><td class="data-input"><input type="number" id="cash_qty_500" value="0" oninput="calculateCash()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="cash_total_500">0.00</td></tr>
                    <tr data-value="100"><td>100</td><td class="data-input"><input type="number" id="cash_qty_100" value="0" oninput="calculateCash()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="cash_total_100">0.00</td></tr>
                    <tr data-value="50"><td>50</td><td class="data-input"><input type="number" id="cash_qty_50" value="0" oninput="calculateCash()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="cash_total_50">0.00</td></tr>
                    <tr data-value="20"><td>20</td><td class="data-input"><input type="number" id="cash_qty_20" value="0" oninput="calculateCash()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="cash_total_20">0.00</td></tr>
                    <tr data-value="10"><td>10</td><td class="data-input"><input type="number" id="cash_qty_10" value="0" oninput="calculateCash()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="cash_total_10">0.00</td></tr>
                    <tr data-value="5"><td>5</td><td class="data-input"><input type="number" id="cash_qty_5" value="0" oninput="calculateCash()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="cash_total_5">0.00</td></tr>
                    <tr data-value="2"><td>2</td><td class="data-input"><input type="number" id="cash_qty_2" value="0" oninput="calculateCash()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="cash_total_2">0.00</td></tr>
                    <tr data-value="1"><td>1</td><td class="data-input"><input type="number" id="cash_qty_1" value="0" oninput="calculateCash()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric"></td><td class="money-field" id="cash_total_1">0.00</td></tr>
                    <tr class="sub-total-row"><td colspan="2">รวม</td><td class="money-field" id="cash_grand_total">0.00</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="detail-table-container final-calc">
            <h3>สรุปยอดและส่วนลด (ต่อ)</h3>
            <div class="cash-box">
                <label>ยอดรวมความคุม (Total Sales)</label>
                <span class="money-field" id="summary_grand_total_sales">0.00</span>
                
                <label>ยอดหักส่วนลด 4%</label>
                <span class="final-diff red-text" id="discount_amount">0.00</span>

                <label>ยอดค้างรับ (เงินเครดิต) **หัก**</label>
                <input type="number" id="debt_in" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric">

                <label>ยอดหักค้าง **หัก**</label>
                <input type="number" id="debt_out_cash" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric">

                <label>ยอดจ่ายค้าง **บวก**</label>
                <input type="number" id="debt_out" value="0" oninput="calculate()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric">
                
                <label>ยอดเงินที่ต้องนำส่งสุทธิ (Net Cash Due)</label>
                <span class="money-field" id="net_cash_due" style="background: #b8daff; font-size: 1.2em;">0.00</span>

                <label style="margin-top: 15px;">ยอดเงินที่ขายได้จริง (ตามบิล/ระบบ)</label>
                <input type="number" id="system_sales_amount" value="0" oninput="calculateDifference()" onfocus="clearZero(this)" onblur="setZero(this)" inputmode="numeric" style="background: #f0f8ff;">

                <label>ผลต่าง (เงินที่นับได้ - ยอดขาย)</label>
                <span class="money-field" id="difference_amount" style="background: #ffe0e0; font-size: 1.1em;">0.00</span>
            </div>
        </div>
    </div>


    <script>
        const iceTypes = ['hl', 'bh', 'bl'];
        const prices = [27, 28, 30, 35, 40]; 
        const fractionalPrice = 100 / 3; 
        const cashDenominations = [1000, 500, 100, 50, 20, 10, 5, 2, 1];

        function formatCurrency(amount) {
            return parseFloat(amount).toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        function getInputValue(id) {
            return parseFloat(document.getElementById(id).value) || 0;
        }
        function clearZero(inputElement) {
            if (inputElement.value === '0') {
                inputElement.value = ''; 
            }
        }
        function setZero(inputElement) {
            if (inputElement.value === '') {
                inputElement.value = '0';
            }
            calculate(); 
            calculateCash(); 
            calculateDifference();
        }

        /** ฟังก์ชัน: คำนวณเงินสดที่นับได้ (ตารางขวา) */
        function calculateCash() {
            let cashGrandTotal = 0;
            
            cashDenominations.forEach(value => {
                const qtyInput = document.getElementById(`cash_qty_${value}`);
                let quantity = Math.max(0, parseInt(qtyInput.value) || 0); 
                const rowTotal = quantity * value;
                
                document.getElementById(`cash_total_${value}`).textContent = formatCurrency(rowTotal);
                cashGrandTotal += rowTotal;
            });
            
            document.getElementById('cash_grand_total').textContent = formatCurrency(cashGrandTotal);
            document.getElementById('actual_cash_counted').textContent = formatCurrency(cashGrandTotal);

            calculateDifference(); 
            return cashGrandTotal;
        }

        /** ฟังก์ชัน: คำนวณผลต่าง (เงินที่นับได้ - ยอดขาย) */
        function calculateDifference() {
            // ดึงค่าเงินสดที่นับได้จากตารางซ้าย
            const actualCash = parseFloat(document.getElementById('actual_cash_counted').textContent.replace(/,/g, '')) || 0;
            // ดึงค่ายอดขายจากช่อง input ที่นำกลับมา
            const systemSales = getInputValue('system_sales_amount');
            const difference = actualCash - systemSales;
            
            const diffElement = document.getElementById('difference_amount');
            diffElement.textContent = formatCurrency(difference);

            diffElement.classList.remove('red-text', 'green-text', 'blue-text');
            if (difference < 0) {
                diffElement.classList.add('red-text');
            } else if (difference > 0) {
                diffElement.classList.add('green-text');
            } else {
                diffElement.classList.add('blue-text'); 
            }
        }


        /** ฟังก์ชันหลัก: คำนวณทุกอย่าง */
        function calculate() {
            let grandTotalSales = 0;
            let grandTotalOut = 0; 
            let grandReturned = 0; 
            let grandNetRemaining = 0; 

            // --- ส่วนที่ 1: คำนวณสต๊อกและยอดที่ขายได้ ---
            iceTypes.forEach(type => {
                // ** FIX: เราต้องดึงค่าจากช่องเดียวที่รวมแล้ว (total_in_...) **
                let totalOut = getInputValue(`total_in_${type}`); 
                
                let returned = getInputValue(`returned_${type}`);
                let freeQty = getInputValue(`free_qty_${type}`);

                let netRemaining = returned; 
                let soldQty = totalOut - returned - freeQty; 
                
                document.getElementById(`total_out_${type}`).textContent = Math.round(totalOut);
                document.getElementById(`net_remaining_${type}`).textContent = Math.round(netRemaining);
                document.getElementById(`sold_qty_${type}`).textContent = Math.round(soldQty);

                grandTotalOut += totalOut;
                grandReturned += returned;
                grandNetRemaining += netRemaining; 
            });
            
            document.getElementById('grand_total_out').textContent = Math.round(grandTotalOut);
            document.getElementById('total_returned').textContent = Math.round(grandReturned);
            document.getElementById('grand_net_remaining').textContent = Math.round(grandNetRemaining);


            // --- ส่วนที่ 2: คำนวณยอดเงิน ---
            iceTypes.forEach(type => {
                let subTotalMoney = 0;
                
                // ราคา 27, 28, 30, 35, 40 บาท
                [27, 28, 30, 35, 40].forEach(price => {
                    const qty = getInputValue(`price_${price}_${type}`);
                    const money = qty * price;
                    document.getElementById(`money_${price}_${type}`).textContent = formatCurrency(money);
                    subTotalMoney += money;
                });
                
                // ราคา 100/3 (33.33 บาท)
                const qty100 = getInputValue(`price_100_${type}`);
                const money100 = qty100 * fractionalPrice;
                document.getElementById(`money_100_${type}`).textContent = formatCurrency(money100);
                subTotalMoney += money100;
                
                // ราคา Custom (ช่อง -)
                const moneyCustom = getInputValue(`price_custom_${type}`); 
                document.getElementById(`money_custom_${type}`).textContent = formatCurrency(moneyCustom);
                subTotalMoney += moneyCustom;
                
                document.getElementById(`sub_total_money_${type}`).textContent = formatCurrency(subTotalMoney);
                grandTotalSales += subTotalMoney;
            });

            // --- ส่วนที่ 3: คำนวณยอดสุทธิ (สรุปยอดเงิน) ---
            
            document.getElementById('grand_total_sales').textContent = formatCurrency(grandTotalSales);
            document.getElementById('summary_grand_total_sales').textContent = formatCurrency(grandTotalSales); 
            
            const discountRate = 0.04;
            const discountAmount = grandTotalSales * discountRate;
            document.getElementById('discount_amount').textContent = formatCurrency(-discountAmount); 

            const debtIn = getInputValue('debt_in'); 
            const debtOutCash = getInputValue('debt_out_cash'); 
            const debtOut = getInputValue('debt_out'); 
            
            const netCashDue = grandTotalSales - discountAmount - debtIn - debtOutCash + debtOut;

            document.getElementById('net_cash_due').textContent = formatCurrency(netCashDue);
            
            if (netCashDue < 0) {
                 document.getElementById('net_cash_due').classList.add('red-text');
                 document.getElementById('net_cash_due').classList.remove('blue-text');
            } else {
                 document.getElementById('net_cash_due').classList.add('blue-text');
                 document.getElementById('net_cash_due').classList.remove('red-text');
            }
            calculateDifference();
        }

        // เรียกฟังก์ชันคำนวณทันทีที่โหลดหน้าจอ
        document.addEventListener('DOMContentLoaded', () => {
             calculate(); 
             calculateCash(); 
        });
    </script>
</body>
</html>
