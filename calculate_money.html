<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó W041-001 (Google Sheet Connected - AjarnG V4)</title>
    <style>
        /* --- CSS Global --- */
        body { font-family: Tahoma, sans-serif; margin: 0; padding: 10px; background: #f0f2f5; font-size: 14px; color: #333; }
        .form-container { 
            width: 98%; 
            max-width: 850px; 
            margin: 10px auto; 
            padding: 15px 10px; 
            background: white; 
            border: 2px solid #333; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            overflow-x: auto; 
        }
        
        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (Ice Stock Table) */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 10px; 
            min-width: 700px; 
            font-size: 0.9em; 
            table-layout: auto;
        }

        /* üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á Header ‡πÅ‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö üî• */
        th, td { 
            border: 1px solid #000; 
            padding: 1px 0px; 
            text-align: center; 
            vertical-align: middle; 
            font-size: 1em; 
            line-height: 1.1; 
        }
        th { 
            background: #dcdcdc; 
            color: #333; 
            font-weight: bold; 
            height: 25px; 
            padding: 2px 0px;
        }
        td.label { 
            text-align: left; 
            font-weight: bold; 
            font-size: 1em; 
            padding-left: 2px; 
            height: 30px; 
        }

        /* üî• ‡∏à‡∏±‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç Input ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î üî• */
        input[type="number"], input[type="text"], input[type="date"], select { 
            width: 100%; 
            padding: 3px 0; 
            text-align: center; /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô Input ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            border: none; 
            box-sizing: border-box; 
            font-size: 1.0em; 
            background: none; 
            height: 25px; 
        } 
        input[type="number"].data-input-field { background: #fdfde7; }


        /* üî• Custom Fix: ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏á‡πÑ‡∏ß‡πâ üî• */
        table tr td:nth-child(14) input[type="number"] {
            height: 35px; 
            font-size: 1.1em;
            font-weight: 900;
            background: #fff8e1; 
            text-align: center; 
        }

        /* üî• ‡∏à‡∏±‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç Output ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î üî• */
        .calculated-field { 
            background: #e0f2f7; 
            font-weight: bold; 
            text-align: center; /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            font-size: 0.9em;
        }
        .money-field { 
            background: #e8f5e9; 
            font-weight: bold; 
            text-align: center; /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            font-size: 0.9em;
        }
        
        .sub-total-row td { background: #c8e6c9; font-weight: bold; padding: 3px 1px; }
        .grand-total-row td { background: #a5d6a7; font-weight: bold; font-size: 1em; white-space: nowrap; }

        /* ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á */
        .variance-row { background: #ffccbc; }
        .variance-field { font-weight: 900; } /* ‡∏™‡∏µ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏î‡πâ‡∏ß‡∏¢ JS */
        
        /* Summary Grid Layout (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ) */
        .summary-grid { display: flex; gap: 20px; }
        .summary-box { flex: 1; min-width: 300px; }
        .summary-row-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .summary-box .money-field-output { border: 1px solid #000; padding: 2px; font-weight: bold; background: #e8f5e9; min-width: 80px; text-align: right; }
        .summary-row-item .data-input-box input { min-width: 80px; }
        .cash-counter-compact input[type="number"] { width: 40px; text-align: center; padding: 5px 0; height: 35px; box-sizing: border-box; }


        /* üî•üî•üî• Ultimate Mobile Fix: Media Query - (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ) üî•üî•üî• */
        @media (max-width: 768px) {
            .summary-grid { flex-direction: column; }
            .form-container { padding: 5px; overflow-x: hidden; } 
            
            table { min-width: unset; table-layout: fixed; width: 100%; display: table; overflow-x: hidden; font-size: 0.6em; }
            table thead tr:nth-child(1) th:nth-child(1) { width: 10%; } 
            table thead tr:nth-child(1) th:nth-child(2) { width: 24%; } 
            table thead tr:nth-child(2) th { width: 4%; } 
            table thead tr:nth-child(1) th:nth-child(8) { width: 4%; } 
            table thead tr:nth-child(1) th:nth-child(9) { width: 4%; } 
            table thead tr:nth-child(1) th:nth-child(10) { width: 4%; } 
            table thead tr:nth-child(1) th:nth-child(11) { width: 4%; } 
            table thead tr:nth-child(1) th:nth-child(12) { width: 5%; } 
            table thead tr:nth-child(1) th:nth-child(13) { width: 45%; } 
            
            table td { padding: 0; } 
            table input[type="number"] { padding: 0; margin: 0; font-size: 0.7em; }
            
            table td:nth-child(13), table td:nth-child(14), table td:nth-child(15) { 
                 text-align: center; 
                 padding-right: 0px;
            }
            table tr td:nth-child(14) input[type="number"] {
                height: 30px; 
                text-align: center;
                font-size: 1.0em;
            }
        }
    </style>
</head>
<body>

<div class="form-container">
    
    <div class="control-panel">
        <div class="control-group">
            <label for="date_select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà üóìÔ∏è</label>
            <input type="date" id="date_select" onchange="switchLog()">
        </div>
        <div class="control-group">
            <label for="truck_select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ üöö</label>
            <select id="truck_select" onchange="switchLog()">
                <option value="‡∏£‡∏ñ 1">‡∏£‡∏ñ 1</option>
                <option value="‡∏£‡∏ñ 2">‡∏£‡∏ñ 2</option>
                <option value="‡∏£‡∏ñ 3">‡∏£‡∏ñ 3</option>
                <option value="‡∏£‡∏ñ 4">‡∏£‡∏ñ 4</option>
                <option value="‡∏£‡∏ñ 5">‡∏£‡∏ñ 5</option>
                <option value="‡∏£‡∏ñ 6">‡∏£‡∏ñ 6</option>
                <option value="‡∏£‡∏ñ 7">‡∏£‡∏ñ 7</option>
                <option value="‡∏£‡∏ñ 8">‡∏£‡∏ñ 8</option>
                <option value="‡∏£‡∏ñ 9">‡∏£‡∏ñ 9</option>
            </select>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th rowspan="2" style="width: 10%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£<br/>‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á</th>
                <th colspan="6">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th rowspan="2" style="width: 4%;">‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡∏Å</th>
                <th rowspan="2" style="width: 4%;">‡∏Ñ‡∏∑‡∏ô<br/>‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th>
                <th rowspan="2" style="width: 4%;">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                <th rowspan="2" style="width: 4%;">‡πÅ‡∏ñ‡∏°/<br/>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</th>
                <th rowspan="2" style="width: 5%; color: red;">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢<br/>(‡∏™‡∏∏‡∏ó‡∏ò‡∏¥)</th>
                <th colspan="3" style="width: 45%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ</th>
            </tr>
            <tr>
                <th style="width: 4%;">1</th>
                <th style="width: 4%;">2</th>
                <th style="width: 4%;">3</th>
                <th style="width: 4%;">4</th>
                <th style="width: 4%;">5</th>
                <th style="width: 4%;">6</th>
                <th style="width: 5%;">‡∏£‡∏≤‡∏Ñ‡∏≤/<br/>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                <th style="width: 5%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                <th style="width: 10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
            </tr>
        </thead>
        <tbody>
            
            <tr>
                <td class="label" rowspan="7">‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà</td>
                <td class="data-input"><input type="number" id="stk_1_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_2_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_3_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_4_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_5_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_6_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="total_in_hl">0</td>
                <td class="data-input"><input type="number" id="returned_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="net_remaining_hl">0</td>
                <td class="data-input"><input type="number" id="free_qty_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="sold_qty_hl">0</td>
                
                <td>**27**</td><td class="data-input"><input type="number" id="qty_27_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_27_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**28**</td><td class="data-input"><input type="number" id="qty_28_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_28_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>30</td><td class="data-input"><input type="number" id="qty_30_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_30_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>35</td><td class="data-input"><input type="number" id="qty_35_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_35_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**3/100**</td><td class="data-input"><input type="number" id="qty_33_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_33_hl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>40</td><td class="data-input"><input type="number" id="qty_40_hl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_40_hl">0.00</td>
            </tr>
             <tr class="variance-row"> 
                <td colspan="12" class="label" style="text-align: right; padding-right: 5px; font-weight: bold;">‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á)</td>
                <td class="calculated-field variance-field" id="sales_variance_hl">0</td>
                <td colspan="1"></td>
            </tr>


             <tr>
                <td class="label" rowspan="7">‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö</td>
                <td class="data-input"><input type="number" id="stk_1_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_2_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_3_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_4_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_5_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_6_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="total_in_bh">0</td>
                <td class="data-input"><input type="number" id="returned_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="net_remaining_bh">0</td>
                <td class="data-input"><input type="number" id="free_qty_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="sold_qty_bh">0</td>
                
                <td>**27**</td><td class="data-input"><input type="number" id="qty_27_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_27_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**28**</td><td class="data-input"><input type="number" id="qty_28_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_28_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>30</td><td class="data-input"><input type="number" id="qty_30_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_30_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>35</td><td class="data-input"><input type="number" id="qty_35_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_35_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**3/100**</td><td class="data-input"><input type="number" id="qty_33_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_33_bh">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>40</td><td class="data-input"><input type="number" id="qty_40_bh" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_40_bh">0.00</td>
            </tr>
             <tr class="variance-row"> 
                <td colspan="12" class="label" style="text-align: right; padding-right: 5px; font-weight: bold;">‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á)</td>
                <td class="calculated-field variance-field" id="sales_variance_bh">0</td>
                <td colspan="1"></td>
            </tr>


            <tr>
                <td class="label" rowspan="7">‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</td>
                <td class="data-input"><input type="number" id="stk_1_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_2_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_3_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_4_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_5_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="data-input"><input type="number" id="stk_6_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="total_in_bl">0</td>
                <td class="data-input"><input type="number" id="returned_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="net_remaining_bl">0</td>
                <td class="data-input"><input type="number" id="free_qty_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td>
                <td class="calculated-field" id="sold_qty_bl">0</td>
                
                <td>**27**</td><td class="data-input"><input type="number" id="qty_27_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_27_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**28**</td><td class="data-input"><input type="number" id="qty_28_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_28_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>30</td><td class="data-input"><input type="number" id="qty_30_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_30_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>35</td><td class="data-input"><input type="number" id="qty_35_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_35_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>**3/100**</td><td class="data-input"><input type="number" id="qty_33_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_33_bl">0.00</td>
            </tr>
            <tr>
                <td colspan="11"></td>
                <td>40</td><td class="data-input"><input type="number" id="qty_40_bl" value="0" oninput="calculate()" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></td><td class="money-field" id="money_40_bl">0.00</td>
            </tr>
             <tr class="variance-row"> 
                <td colspan="12" class="label" style="text-align: right; padding-right: 5px; font-weight: bold;">‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á)</td>
                <td class="calculated-field variance-field" id="sales_variance_bl">0</td>
                <td colspan="1"></td>
            </tr>


            <tr class="sub-total-row">
                <td colspan="1" class="label">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</td>
                <td class="calculated-field" id="total_stk_1">0</td>
                <td class="calculated-field" id="total_stk_2">0</td>
                <td class="calculated-field" id="total_stk_3">0</td>
                <td class="calculated-field" id="total_stk_4">0</td>
                <td class="calculated-field" id="total_stk_5">0</td>
                <td class="calculated-field" id="total_stk_6">0</td>
                <td class="calculated-field" id="grand_total_in">0</td>
                <td class="calculated-field" id="total_returned">0</td>
                <td class="calculated-field" id="grand_net_remaining">0</td>
                <td class="calculated-field" id="total_free">0</td>
                <td class="calculated-field" id="grand_sold_qty">0</td>
                <td colspan="2" class="label" style="text-align: right; padding-right: 5px;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≤‡∏¢</td>
                <td class="money-field" id="grand_total_sales_final">0.00</td> 
            </tr>
        </tbody>
    </table>
    
    <div class="summary-grid">
        <div class="summary-box summary-left">
            <h4 style="margin: 0 0 5px 0; border-bottom: 1px dotted #ccc;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏•‡∏ö</h4>
            <div class="summary-row-item">
                <label>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡∏° (Total Sales)</label>
                <div class="money-field-output" id="summary_grand_total_sales">0.00</div>
            </div>
             <div class="summary-row-item discount-row">
                <label style="color: red;">‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î **4%**</label>
                <div class="money-field-output" id="discount_amount" style="color: red;">0.00</div>
            </div>
             <div class="summary-row-item">
                <label style="font-size: 1.1em;">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</label>
                <div class="money-field-output" id="net_sales_after_discount" style="background: #e0f7fa; font-size: 1.1em;">0.00</div>
            </div>
            <div class="summary-row-item">
                <label>‡∏´‡∏±‡∏Å ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</label>
                <div class="data-input-box"><input type="number" id="debt_in" value="0" oninput="calculate();" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></div>
            </div>
            <div class="summary-row-item">
                <label>‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö</label>
                <div class="data-input-box"><input type="number" id="debt_out_cash" value="0" oninput="calculate();" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></div>
            </div>
            <div class="summary-row-item">
                <label>‡∏¢‡∏≠‡∏î‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πâ‡∏≤‡∏á (+)</label>
                <div class="data-input-box"><input type="number" id="debt_pay_out" value="0" oninput="calculate();" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></div>
            </div>
            <div class="summary-row-item">
                <label style="font-size: 1.1em;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô</label>
                <div class="money-field-output" id="total_after_debt" style="font-size: 1.1em; background: #ffe6f2;">0.00</div>
            </div>
            <div class="summary-row-item">
                <label>‡∏´‡∏±‡∏Å ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô (‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ)</label>
                <div class="data-input-box"><input type="number" id="transfer_money" value="0" oninput="calculate();" onfocus="clearAndFocus(this)" class="data-input-field" inputmode="numeric"></div>
            </div>
            <div class="summary-row-item">
                <label style="font-size: 1.1em;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Net Cash Due)</label>
                <div class="money-field-output" id="net_cash_due" style="background: #b8daff; font-size: 1.1em;">0.00</div>
            </div>
        </div>
        
        <div class="summary-box summary-right">
            <h4 style="margin: 0 0 5px 0; border-bottom: 1px dotted #ccc;">
                <span style="font-size: 1.5em; color: #ffc107;">üíµ</span> ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ
            </h4>
            
            <table class="cash-counter-compact">
                <thead>
                    <tr>
                        <th style="width: 25%;">‡∏ä‡∏ô‡∏¥‡∏î<br/>(‡∏ö‡∏≤‡∏ó)</th> 
                        <th style="width: 45%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th> 
                        <th style="width: 30%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô<br/>(‡∏ö‡∏≤‡∏ó)</th> 
                    </tr>
                </thead>
                <tbody>
                    <tr id="cash_row_1000">
                        <td class="denomination-label">1,000</td>
                        <td><div class="qty-control"><button onclick="adjustQty('cash_qty_1000', -1)" class="adjust-btn minus-btn">-</button><input type="number" min="0" value="0" id="cash_qty_1000" oninput="calculateCash();" onfocus="clearAndFocus(this)" class="cash-qty-input" inputmode="numeric"><button onclick="adjustQty('cash_qty_1000', 1)" class="adjust-btn plus-btn">+</button></div></td>
                        <td class="cash-total-display" id="cash_total_1000">0.00</td>
                    </tr>
                    <tr id="cash_row_500">
                        <td class="denomination-label">500</td>
                        <td><div class="qty-control"><button onclick="adjustQty('cash_qty_500', -1)" class="adjust-btn minus-btn">-</button><input type="number" min="0" value="0" id="cash_qty_500" oninput="calculateCash();" onfocus="clearAndFocus(this)" class="cash-qty-input" inputmode="numeric"><button onclick="adjustQty('cash_qty_500', 1)" class="adjust-btn plus-btn">+</button></div></td>
                        <td class="cash-total-display" id="cash_total_500">0.00</td>
                    </tr>
                    <tr id="cash_row_100">
                        <td class="denomination-label">100</td>
                        <td><div class="qty-control"><button onclick="adjustQty('cash_qty_100', -1)" class="adjust-btn minus-btn">-</button><input type="number" min="0" value="0" id="cash_qty_100" oninput="calculateCash();" onfocus="clearAndFocus(this)" class="cash-qty-input" inputmode="numeric"><button onclick="adjustQty('cash_qty_100', 1)" class="adjust-btn plus-btn">+</button></div></td>
                        <td class="cash-total-display" id="cash_total_100">0.00</td>
                    </tr>
                    <tr id="cash_row_50">
                        <td class="denomination-label">50</td>
                        <td><div class="qty-control"><button onclick="adjustQty('cash_qty_50', -1)" class="adjust-btn minus-btn">-</button><input type="number" min="0" value="0" id="cash_qty_50" oninput="calculateCash();" onfocus="clearAndFocus(this)" class="cash-qty-input" inputmode="numeric"><button onclick="adjustQty('cash_qty_50', 1)" class="adjust-btn plus-btn">+</button></div></td>
                        <td class="cash-total-display" id="cash_total_50">0.00</td>
                    </tr>
                    <tr id="cash_row_20">
                        <td class="denomination-label">20</td>
                        <td><div class="qty-control"><button onclick="adjustQty('cash_qty_20', -1)" class="adjust-btn minus-btn">-</button><input type="number" min="0" value="0" id="cash_qty_20" oninput="calculateCash();" onfocus="clearAndFocus(this)" class="cash-qty-input" inputmode="numeric"><button onclick="adjustQty('cash_qty_20', 1)" class="adjust-btn plus-btn">+</button></div></td>
                        <td class="cash-total-display" id="cash_total_20">0.00</td>
                    </tr>
                    <tr id="cash_row_10">
                        <td class="denomination-label">10</td>
                        <td><div class="qty-control"><button onclick="adjustQty('cash_qty_10', -1)" class="adjust-btn minus-btn">-</button><input type="number" min="0" value="0" id="cash_qty_10" oninput="calculateCash();" onfocus="clearAndFocus(this)" class="cash-qty-input" inputmode="numeric"><button onclick="adjustQty('cash_qty_10', 1)" class="adjust-btn plus-btn">+</button></div></td>
                        <td class="cash-total-display" id="cash_total_10">0.00</td>
                    </tr>
                    <tr id="cash_row_5">
                        <td class="denomination-label">5</td>
                        <td><div class="qty-control"><button onclick="adjustQty('cash_qty_5', -1)" class="adjust-btn minus-btn">-</button><input type="number" min="0" value="0" id="cash_qty_5" oninput="calculateCash();" onfocus="clearAndFocus(this)" class="cash-qty-input" inputmode="numeric"><button onclick="adjustQty('cash_qty_5', 1)" class="adjust-btn plus-btn">+</button></div></td>
                        <td class="cash-total-display" id="cash_total_5">0.00</td>
                    </tr>
                    <tr id="cash_row_2">
                        <td class="denomination-label">2</td>
                        <td><div class="qty-control"><button onclick="adjustQty('cash_qty_2', -1)" class="adjust-btn minus-btn">-</button><input type="number" min="0" value="0" id="cash_qty_2" oninput="calculateCash();" onfocus="clearAndFocus(this)" class="cash-qty-input" inputmode="numeric"><button onclick="adjustQty('cash_qty_2', 1)" class="adjust-btn plus-btn">+</button></div></td>
                        <td class="cash-total-display" id="cash_total_2">0.00</td>
                    </tr>
                    <tr id="cash_row_1">
                        <td class="denomination-label">1</td>
                        <td><div class="qty-control"><button onclick="adjustQty('cash_qty_1', -1)" class="adjust-btn minus-btn">-</button><input type="number" min="0" value="0" id="cash_qty_1" oninput="calculateCash();" onfocus="clearAndFocus(this)" class="cash-qty-input" inputmode="numeric"><button onclick="adjustQty('cash_qty_1', 1)" class="adjust-btn plus-btn">+</button></div></td>
                        <td class="cash-total-display" id="cash_total_1">0.00</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr class="grand-total-cash-row">
                        <td colspan="2">‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ</td>
                        <td id="cash_grand_total">0.00</td>
                    </tr>
                </tfoot>
            </table>
            
            <span id="actual_cash_counted" style="display: none;">0</span>

            <div class="cash-summary-footer">
                
                <div class="summary-row">
                    <label>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á (‡∏ï‡∏≤‡∏°‡∏ö‡∏¥‡∏•/‡∏£‡∏∞‡∏ö‡∏ö)</label>
                    <input type="number" id="system_sales_amount" value="0" oninput="calculateDifference(parseFloat(document.getElementById('actual_cash_counted').textContent) || 0);" onfocus="clearAndFocus(this)" class="data-input-field sales-input" inputmode="numeric">
                </div>
                
                <div class="summary-row">
                    <label>‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ - ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢)</label>
                    <input type="text" id="difference_amount" value="0.00" readonly style="background: #ffe0e0; font-weight: bold; padding: 2px 5px; border: 1px solid #ccc; width: 50%; height: 25px; text-align: right; box-sizing: border-box;">
                </div>

                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="reset-button" onclick="resetCurrentLog()">
                        ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô/‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                    </button>
                    <button style="flex: 1;" onclick="saveAndExport()">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    // üî•üî•üî• 1. URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy (‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÅ‡∏•‡πâ‡∏ß) üî•üî•üî•
    const APPS_SCRIPT_URL = "Https://script.google.com/macros/s/AKfycbzVR2cAX03v20hV8wanb0gabQbzw5rYo2rWT5XCO-Xkf7e1IXCrlafZ50iPnUwp5x1Y/exec";

    const iceTypes = ['hl', 'bh', 'bl'];
    const pricesHL = [27, 28, 30, 35, 33.33333333333333, 40]; 
    const pricesBH = [27, 28, 30, 35, 33.33333333333333, 40]; 
    const pricesBL = [27, 28, 30, 35, 33.33333333333333, 40];
    const cashDenominations = [1000, 500, 100, 50, 20, 10, 5, 2, 1];
    const allInputIds = []; // ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô DOMContentLoaded
    const truckNames = ["‡∏£‡∏ñ 1", "‡∏£‡∏ñ 2", "‡∏£‡∏ñ 3", "‡∏£‡∏ñ 4", "‡∏£‡∏ñ 5", "‡∏£‡∏ñ 6", "‡∏£‡∏ñ 7", "‡∏£‡∏ñ 8", "‡∏£‡∏ñ 9"];


    document.addEventListener('DOMContentLoaded', () => {
        // Collect all input/select IDs
        document.querySelectorAll('input, select').forEach(el => {
            if (el.id && el.id !== 'difference_amount' && el.id !== 'date_select' && el.id !== 'truck_select') {
                allInputIds.push(el.id);
            }
        });

        const dateSelect = document.getElementById('date_select');
        const today = new Date().toISOString().split('T')[0];
        dateSelect.value = today;
        
        const storedTruckId = localStorage.getItem('currentTruckId') || '‡∏£‡∏ñ 1';
        document.getElementById('truck_select').value = storedTruckId;
        
        switchLog(); // üìç ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ switchLog (‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Google Sheet)
    });

    // ################ State Management (Save/Load/Reset) - Google Sheet Version ################

    function generateLogKey() {
        return true; 
    }

    // üî• 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô SAVE STATE (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets) üî•
    async function saveState() {
        if (!APPS_SCRIPT_URL) return;
        
        const dataToSend = {};
        const date = document.getElementById('date_select').value;
        const truckId = document.getElementById('truck_select').value;
        
        dataToSend['date_select'] = date;
        dataToSend['truck_select'] = truckId;
        
        allInputIds.forEach(id => {
            const el = document.getElementById(id);
            if (el && el.tagName !== 'SELECT') {
                let value = el.value.trim() === '' ? 0 : parseFloat(el.value) || 0;
                dataToSend[id] = value;
            } else if (el && el.tagName === 'SELECT') {
                dataToSend[id] = el.value;
            }
        });

        try {
            const response = await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(dataToSend),
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();
            // console.log("Save Result:", result); 
        } catch (error) {
            // console.error("Network error while saving:", error);
        }
    }

    // üî• 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô LOAD STATE (‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets) üî•
    async function loadState() {
        if (!APPS_SCRIPT_URL) return;

        const date = document.getElementById('date_select').value;
        const truckId = document.getElementById('truck_select').value;

        if (!date || !truckId) return;

        const fetchUrl = `${APPS_SCRIPT_URL}?date=${date}&truck=${encodeURIComponent(truckId)}`;

        try {
            const response = await fetch(fetchUrl);
            const result = await response.json();
            
            allInputIds.forEach(id => {
                const el = document.getElementById(id);
                if (el && el.tagName !== 'SELECT' && !el.classList.contains('calculated-field') && !el.classList.contains('money-field')) {
                    el.value = '0'; 
                }
            });

            if (result.result === 'success') {
                const sheetData = result.data;
                allInputIds.forEach(id => {
                    const el = document.getElementById(id);
                    if (el && sheetData[id] !== undefined) {
                        let value = sheetData[id];
                        if (typeof value === 'object' && value instanceof Date) {
                           value = value.toISOString().split('T')[0];
                        }
                        el.value = String(value);
                    }
                });
            }
            
        } catch (error) {
            // console.error("Network error while loading:", error);
        }
        
        calculateCash();
        calculate();
    }

    // üî• 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô SWITCH LOG (‡πÉ‡∏ä‡πâ loadState ‡πÉ‡∏´‡∏°‡πà) üî•
    function switchLog() {
        localStorage.setItem('currentTruckId', document.getElementById('truck_select').value);
        loadState(); 
    }

    // üî• 5. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô RESET CURRENT LOG (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 0 ‡∏•‡∏á Sheet) üî•
    function resetCurrentLog() {
        const date = document.getElementById('date_select').value;
        const truckId = document.getElementById('truck_select').value;
        
        if (confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á ${truckId} ‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${date} ‡∏ô‡∏µ‡πâ? (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Sheet ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô 0)`)) {
            allInputIds.forEach(id => {
                const el = document.getElementById(id);
                if (el && el.tagName !== 'SELECT' && !el.hasAttribute('readonly')) {
                     el.value = '0';
                }
            });
            
            calculateCash();
            calculate(); 
            saveState(); 
            
            alert(`‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (0) ‡πÉ‡∏ô Google Sheet ‡πÅ‡∏•‡πâ‡∏ß!`);
        }
    }
    
    // ################ Utility Functions ################
    function formatCurrency(amount) {
        return parseFloat(amount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    function getInputValue(id) {
        const inputElement = document.getElementById(id);
        if (!inputElement || inputElement.value.trim() === '-' || inputElement.value.trim() === '') {
            return 0;
        }
        return Math.round(parseFloat(inputElement.value) * 100) / 100 || 0;
    }

    function getElementContent(id) {
        const el = document.getElementById(id);
        if (!el) return 'N/A';
        const content = el.textContent.trim().replace(/,/g, '');
        return content || '0'; 
    }
    
    function clearAndFocus(inputElement) {
        inputElement.setAttribute('inputmode', 'decimal'); 
        if (inputElement.value === '0') {
            inputElement.value = ''; 
        }
    }
    
    // üî• ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Event Listener ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å saveState() üî•
    document.addEventListener('blur', (event) => {
        const isDataField = event.target.classList.contains('data-input-field');
        const isCashField = event.target.classList.contains('cash-qty-input');
        const isSummaryField = ['debt_in', 'debt_out_cash', 'debt_pay_out', 'transfer_money', 'system_sales_amount'].includes(event.target.id);

        if (isDataField || isCashField || isSummaryField) {
            if (event.target.value === '') {
                event.target.value = '0';
            }
            calculate();
            calculateCash();
            saveState(); // üìç ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet
        }
    }, true); 
    
    // üî• ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Adjust Qty ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å saveState() üî•
    function adjustQty(id, delta) {
        const inputElement = document.getElementById(id);
        let currentQty = parseInt(inputElement.value) || 0; 
        let newQty = currentQty + delta;
        if (newQty < 0) newQty = 0;
        
        inputElement.value = newQty;
        
        calculateCash(); 
        saveState(); // üìç ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet
    }


    function calculateCash() {
        let cashGrandTotal = 0;
        cashDenominations.forEach(value => {
            const qty = getInputValue(`cash_qty_${value}`);
            const rowTotal = qty * value;
            document.getElementById(`cash_total_${value}`).textContent = formatCurrency(rowTotal);
            cashGrandTotal += rowTotal;
        });
        
        cashGrandTotal = Math.round(cashGrandTotal * 100) / 100;
        
        document.getElementById('cash_grand_total').textContent = formatCurrency(cashGrandTotal);
        document.getElementById('actual_cash_counted').textContent = cashGrandTotal; 
        
        calculateDifference(cashGrandTotal);
        return cashGrandTotal;
    }

    function calculateDifference(actualCash) {
        const systemSales = getInputValue('system_sales_amount');
        const difference = actualCash - systemSales;
        const roundedDifference = Math.round(difference * 100) / 100;
        const diffElement = document.getElementById('difference_amount');
        diffElement.value = formatCurrency(roundedDifference); 
        diffElement.style.backgroundColor = (roundedDifference < 0) ? '#ffb3b3' : (roundedDifference > 0) ? '#c2f0c2' : '#f0f8ff';
    }
    
    function customRound(amount) {
        const decimalPart = amount % 1; 
        if (decimalPart >= 0.60 - 0.000001) { 
            return Math.ceil(amount); 
        } else {
            return Math.floor(amount); 
        }
    }


    /** ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) */
    function calculate() {
        let grandTotalSales = 0;
        let grandTotalIn = 0; 
        let grandReturned = 0; 
        let grandNetRemaining = 0; 
        let totalFree = 0;
        let grandSoldQty = 0; 

        let totalStk1 = 0;
        let totalStk2 = 0;
        let totalStk3 = 0;
        let totalStk4 = 0;
        let totalStk5 = 0;
        let totalStk6 = 0;

        iceTypes.forEach(type => {
            let totalIn = 0;
            for (let i = 1; i <= 6; i++) {
                const stkValue = getInputValue(`stk_${i}_${type}`);
                totalIn += stkValue;
                if (i === 1) totalStk1 += stkValue;
                else if (i === 2) totalStk2 += stkValue;
                else if (i === 3) totalStk3 += stkValue;
                else if (i === 4) totalStk4 += stkValue;
                else if (i === 5) totalStk5 += stkValue;
                else if (i === 6) totalStk6 += stkValue;
            }
            
            let returned = getInputValue(`returned_${type}`);
            let freeQty = getInputValue(`free_qty_${type}`);

            let netRemaining = totalIn - returned; 
            let soldQty = netRemaining - freeQty; 
            
            document.getElementById(`total_in_${type}`).textContent = Math.round(totalIn);
            document.getElementById(`net_remaining_${type}`).textContent = Math.round(netRemaining);
            document.getElementById(`sold_qty_${type}`).textContent = Math.round(soldQty); 

            grandTotalIn += totalIn;
            grandReturned += returned;
            grandNetRemaining += netRemaining; 
            totalFree += freeQty;
            grandSoldQty += soldQty; 

            let subTotalMoney = 0;
            let totalQtySoldRecorded = 0;
            let currentPrices = [];
            
            if (type === 'hl') currentPrices = pricesHL;
            else if (type === 'bh') currentPrices = pricesBH;
            else if (type === 'bl') currentPrices = pricesBL;

            currentPrices.forEach(priceValue => {
                let basePrice = (priceValue === 33.33333333333333) ? '33' : String(priceValue);
                const qty = getInputValue(`qty_${basePrice}_${type}`);
                totalQtySoldRecorded += qty;
                
                let money = qty * priceValue;
                money = Math.round(money * 100) / 100;
                
                const moneyElement = document.getElementById(`money_${basePrice}_${type}`);
                if (moneyElement) {
                    moneyElement.textContent = formatCurrency(money);
                    subTotalMoney += money;
                }
            });
            
            let salesVariance = soldQty - totalQtySoldRecorded; 
            salesVariance = Math.round(salesVariance * 100) / 100; 

            const varianceElement = document.getElementById(`sales_variance_${type}`);
            varianceElement.textContent = salesVariance;
            
            if (salesVariance === 0) {
                varianceElement.style.color = '#1b5e20'; // Green
            } else {
                varianceElement.style.color = '#d32f2f'; // Red
            }
            
            subTotalMoney = Math.round(subTotalMoney * 100) / 100;
            grandTotalSales += subTotalMoney; 
        });

        grandTotalSales = Math.round(grandTotalSales * 100) / 100;

        document.getElementById('total_stk_1').textContent = Math.round(totalStk1);
        document.getElementById('total_stk_2').textContent = Math.round(totalStk2);
        document.getElementById('total_stk_3').textContent = Math.round(totalStk3);
        document.getElementById('total_stk_4').textContent = Math.round(totalStk4);
        document.getElementById('total_stk_5').textContent = Math.round(totalStk5);
        document.getElementById('total_stk_6').textContent = Math.round(totalStk6);
        document.getElementById('grand_total_in').textContent = Math.round(grandTotalIn);
        document.getElementById('total_returned').textContent = Math.round(grandReturned);
        document.getElementById('grand_net_remaining').textContent = Math.round(grandNetRemaining);
        document.getElementById('total_free').textContent = Math.round(totalFree);
        document.getElementById('grand_sold_qty').textContent = Math.round(grandSoldQty); 
        document.getElementById('grand_total_sales_final').textContent = formatCurrency(grandTotalSales); 
        document.getElementById('summary_grand_total_sales').textContent = formatCurrency(grandTotalSales);
        
        const discountRate = 0.04;
        let discountAmount = customRound(grandTotalSales * discountRate); 
        let netSalesAfterDiscount = Math.round((grandTotalSales - discountAmount) * 100) / 100;
        
        const debtIn = getInputValue('debt_in'); 
        const debtOutCash = getInputValue('debt_out_cash'); 
        const debtPayOut = getInputValue('debt_pay_out'); 
        const transferMoney = getInputValue('transfer_money'); 
        
        let totalAfterDebt = Math.round((netSalesAfterDiscount - debtIn - debtOutCash + debtPayOut) * 100) / 100;
        let netCashDue = Math.round((totalAfterDebt - transferMoney) * 100) / 100;
        
        document.getElementById('discount_amount').textContent = formatCurrency(-discountAmount); 
        document.getElementById('net_sales_after_discount').textContent = formatCurrency(netSalesAfterDiscount); 
        document.getElementById('total_after_debt').textContent = formatCurrency(totalAfterDebt);
        document.getElementById('net_cash_due').textContent = formatCurrency(netCashDue);
        
        const actualCash = parseFloat(document.getElementById('actual_cash_counted').textContent) || 0;
        calculateDifference(actualCash);
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
    function saveAndExport() {
        const date = document.getElementById('date_select').value; 
        const truckId = document.getElementById('truck_select').value;
        const netCashDue = parseFloat(getElementContent('net_cash_due')) || 0;
        const countedCash = parseFloat(getElementContent('actual_cash_counted')) || 0;

        let reportData = `=== ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ ${truckId} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${date} ===\n`; 
        reportData += `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: ${new Date().toLocaleString('th-TH')}\n`;
        reportData += `---------------------------------------------------\n`;
        
        reportData += `[‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô]\n`;
        reportData += `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≤‡∏¢ (‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏±‡∏Å): ${document.getElementById('summary_grand_total_sales').textContent} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 4%: ${document.getElementById('discount_amount').textContent} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: ${document.getElementById('net_sales_after_discount').textContent} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏´‡∏±‡∏Å‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï: ${getInputValue('debt_in')} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö: ${getInputValue('debt_out_cash')} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏¢‡∏≠‡∏î‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πâ‡∏≤‡∏á (+): ${getInputValue('debt_pay_out')} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô (‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏´‡∏ô‡∏µ‡πâ): ${document.getElementById('total_after_debt').textContent} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô: ${getInputValue('transfer_money')} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Net Cash Due): ${document.getElementById('net_cash_due').textContent} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á: ${formatCurrency(countedCash)} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á (‡∏ï‡∏≤‡∏°‡∏ö‡∏¥‡∏•/‡∏£‡∏∞‡∏ö‡∏ö): ${getInputValue('system_sales_amount')} ‡∏ö‡∏≤‡∏ó\n`;
        reportData += `‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ - ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢): ${document.getElementById('difference_amount').value} ‡∏ö‡∏≤‡∏ó\n\n`;

        reportData += `[‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô]\n`;
        reportData += `‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡∏Å (1-6): ${document.getElementById('grand_total_in').textContent}\n`;
        reportData += `‡∏Ñ‡∏∑‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${document.getElementById('total_returned').textContent}\n`;
        reportData += `‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${document.getElementById('grand_net_remaining').textContent}\n`;
        reportData += `‡πÅ‡∏ñ‡∏°/‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ${document.getElementById('total_free').textContent}\n`;
        reportData += `‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏™‡∏∏‡∏ó‡∏ò‡∏¥): ${document.getElementById('grand_sold_qty').textContent}\n\n`;

        reportData += `[‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á]\n`;
        iceTypes.forEach(type => {
            const label = (type === 'hl' ? '‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà' : type === 'bh' ? '‡∏ö‡∏î‡∏´‡∏¢‡∏≤‡∏ö' : '‡∏ö‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î');
            
            reportData += `--- ${label} ---\n`;
            reportData += `‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡∏Å: ${document.getElementById(`total_in_${type}`).textContent} | **‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å:** ${getInputValue(`returned_${type}`)} | ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${document.getElementById(`net_remaining_${type}`).textContent} | ‡πÅ‡∏ñ‡∏°: ${getInputValue(`free_qty_${type}`)} | ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${document.getElementById(`sold_qty_${type}`).textContent}\n`;
            
            let stockDetail = '';
            for(let i = 1; i <= 6; i++) {
                 stockDetail += ` STK(${i}): ${getInputValue(`stk_${i}_${type}`)} |`;
            }
            reportData += `‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏¢‡πà‡∏≠‡∏¢:|${stockDetail}\n`;

            reportData += `‡∏Ç‡∏≤‡∏¢: | QTY(27): ${getInputValue(`qty_27_${type}`)} | QTY(28): ${getInputValue(`qty_28_${type}`)} | QTY(30): ${getInputValue(`qty_30_${type}`)} | QTY(35): ${getInputValue(`qty_35_${type}`)} | QTY(3/100): ${getInputValue(`qty_33_${type}`)} | QTY(40): ${getInputValue(`qty_40_${type}`)}\n`;
            reportData += `‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (‡∏Ç‡∏≤‡∏î/‡πÄ‡∏Å‡∏¥‡∏ô): ${document.getElementById(`sales_variance_${type}`).textContent}\n\n`;
        });
        
        reportData += `[‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ]\n`;
        cashDenominations.forEach(value => {
            reportData += `‡∏ä‡∏ô‡∏¥‡∏î ${value} ‡∏ö‡∏≤‡∏ó: ${getInputValue(`cash_qty_${value}`)} ‡πÉ‡∏ö | ‡∏£‡∏ß‡∏°: ${document.getElementById(`cash_total_${value}`).textContent} ‡∏ö‡∏≤‡∏ó\n`;
        });
        reportData += `‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ: ${document.getElementById('cash_grand_total').textContent} ‡∏ö‡∏≤‡∏ó\n`;

        const cleanTruckId = truckId.replace(/\s/g, ''); 
        const cleanDate = date.replace(/-/g, ''); 
        const finalMoney = Math.round(netCashDue); 
        
        const fileName = `${cleanDate}_${cleanTruckId}_${finalMoney}.txt`; 

        const blob = new Blob([reportData], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${truckId} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${date}! ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${fileName}`);
    }

</script>
</body>
</html>
