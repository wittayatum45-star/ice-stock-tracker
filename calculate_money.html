// üî•üî•üî• ‡∏Å‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ "‡∏ó‡∏±‡∏ö" ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô HTML ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üî•üî•üî•
async function saveToCloud() {
    
    // 1. ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà API (‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏≠‡∏á)
    const API_URL = "https://script.google.com/macros/s/AKfycbz0IdqLMXpTuDiMM24Qop5-HyqmCyxtJmerRFoaFZaLLkB-omIId4F9Eiv8YoDRD5fZ8g/exec"; 

    // üî¥ Debug 1: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏°‡∏±‡πâ‡∏¢
    alert('Debug 1: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô saveToCloud()');

    // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "‡∏™‡∏£‡∏∏‡∏õ" ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    const payload = {
        date: document.getElementById('date_select').value,
        truckId: document.getElementById('truck_select').value,
        
        // ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
        grandTotalSales: getCalculatedValue('summary_grand_total_sales'),
        discountAmount: getCalculatedValue('discount_amount'),
        netSalesAfterDiscount: getCalculatedValue('net_sales_after_discount'),
        debtIn: getInputValue('debt_in'),
        debtOutCash: getInputValue('debt_out_cash'),
        debtPayOut: getInputValue('debt_pay_out'),
        totalAfterDebt: getCalculatedValue('total_after_debt'),
        transferMoney: getInputValue('transfer_money'),
        netCashDue: getCalculatedValue('net_cash_due'),
        
        // ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
        actualCashCounted: getCalculatedValue('actual_cash_counted'),
        systemSalesAmount: getInputValue('system_sales_amount'),
        differenceAmount: getCalculatedValue('difference_amount'),
        
        // ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ï‡πá‡∏≠‡∏Å
        grandTotalIn: getCalculatedValue('grand_total_in'),
        totalReturned: getCalculatedValue('total_returned'),
        totalFree: getCalculatedValue('total_free'),
        grandSoldQty: getCalculatedValue('grand_sold_qty'),
        
        // ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (Variance)
        salesVarianceHL: getCalculatedValue('sales_variance_hl'),
        salesVarianceBH: getCalculatedValue('sales_variance_bh'),
        salesVarianceBL: getCalculatedValue('sales_variance_bl')
    };
    
    // üî¥ Debug 2: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á payload (‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏û‡∏±‡∏™‡∏î‡∏∏) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏°‡∏±‡πâ‡∏¢
    alert('Debug 2: ‡∏™‡∏£‡πâ‡∏≤‡∏á Payload (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á... ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
    
    // 3. "‡∏¢‡∏¥‡∏á" ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Payload) ‡πÑ‡∏õ‡∏ó‡∏µ‡πà API
    try {
        // üî¥ Debug 3: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏¢‡∏¥‡∏á "‡∏ó‡πà‡∏≠"
        alert('Debug 3: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏¢‡∏¥‡∏á Fetch (‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ‡πÑ‡∏õ‡∏ó‡∏µ‡πà API...');

        const response = await fetch(API_URL, {
            method: 'POST',
            mode: 'no-cors', 
            cache: 'no-cache',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
            redirect: 'follow'
        });

        // üî¥ Debug 4: ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ = ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πá Error ‡∏ó‡∏µ‡πà App Script)
        alert('Debug 4: ‚úÖ ‡∏¢‡∏¥‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß! (‡πÑ‡∏°‡πà Error ‡∏ù‡∏±‡πà‡∏á HTML)');

    } catch (error) {
        // üî¥ Debug 5: ‡∏ñ‡πâ‡∏≤‡∏°‡∏±‡∏ô‡πÄ‡∏î‡πâ‡∏á‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ... ‡∏Ñ‡∏∑‡∏≠ "‡∏û‡∏±‡∏á" ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏™‡πà‡∏á!
        console.error('Error saving to cloud:', error);
        alert("Debug 5: ‚ùå ‡∏û‡∏±‡∏á! ‡πÄ‡∏Å‡∏¥‡∏î Error ‡∏ù‡∏±‡πà‡∏á HTML: " + error.message);
    }
}
